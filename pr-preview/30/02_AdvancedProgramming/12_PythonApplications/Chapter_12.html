<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 12: Python Applications – Beginning to Code with Python: Notes, Examples and Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fd21d93db373728c2f8fcda4b672d2ec.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Chapter 12: Python Applications – Beginning to Code with Python: Notes, Examples and Exercises">
<meta property="og:image" content="./Examples/10_FashionShopWithDocumentation/pydoc_screenshot.png">
<meta property="og:site_name" content="Beginning to Code with Python: Notes, Examples and Exercises">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Beginning to Code with Python: Notes, Examples and Exercises</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../02_AdvancedProgramming/09_UsingClasses/Chapter_09.html">Advanced Programming</a></li><li class="breadcrumb-item"><a href="../../02_AdvancedProgramming/12_PythonApplications/Chapter_12.html">Chapter 12: Python Applications</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Programming Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/02_PythonAndProgramming/Chapter_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Python and Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/03_PythonProgramStructure/Chapter_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Python Program Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/04_WorkingWithVariables/Chapter_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Working With Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/05_MakingDecisions/Chapter_05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Making Decisions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/06_RepeatingActionsWithLoops/Chapter_06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Repeating Actions with Loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/07_UsingFunctions/Chapter_07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7: Using Functions to Simplify Programs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_ProgrammingFundamentals/08_StoringCollectionsOfData/Chapter_08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 8: Storing Collections of Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../02_AdvancedProgramming/09_UsingClasses/Chapter_09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 9: Use Classes to Store Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_AdvancedProgramming/09_UsingClasses/Chapter_09_ExtensionExercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extended Exercises for Chapter 9</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_AdvancedProgramming/10_UseClassesToCreateActiveObjects/Chapter_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 10: Using Classes to Create Active Objects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_AdvancedProgramming/11_ObjectBasedSolutionDesign/Chapter_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 11: Object-based Solution Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_AdvancedProgramming/12_PythonApplications/Chapter_12.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 12: Python Applications</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Useful Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03_UsefulPython/13_PythonAndGraphicalUserInterfaces/Chapter_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 13: Python and Graphical User Interfaces</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#notes" id="toc-notes" class="nav-link active" data-scroll-target="#notes">Notes</a>
  <ul>
  <li><a href="#advanced-functions" id="toc-advanced-functions" class="nav-link" data-scroll-target="#advanced-functions">Advanced Functions</a>
  <ul>
  <li><a href="#references-to-functions" id="toc-references-to-functions" class="nav-link" data-scroll-target="#references-to-functions">References to Functions</a>
  <ul>
  <li><a href="#use-function-references-in-the-btcinput-module" id="toc-use-function-references-in-the-btcinput-module" class="nav-link" data-scroll-target="#use-function-references-in-the-btcinput-module">Use Function References in the BTCInput Module</a></li>
  <li><a href="#code-analysis-function-references" id="toc-code-analysis-function-references" class="nav-link" data-scroll-target="#code-analysis-function-references">Code Analysis: Function References</a></li>
  <li><a href="#exercise-write-a-roman-numeral-converter" id="toc-exercise-write-a-roman-numeral-converter" class="nav-link" data-scroll-target="#exercise-write-a-roman-numeral-converter">Exercise: Write a Roman Numeral Converter</a></li>
  </ul></li>
  <li><a href="#build-lists-of-function-references" id="toc-build-lists-of-function-references" class="nav-link" data-scroll-target="#build-lists-of-function-references">Build Lists of Function References</a></li>
  <li><a href="#use-lambda-expressions" id="toc-use-lambda-expressions" class="nav-link" data-scroll-target="#use-lambda-expressions">Use Lambda Expressions</a>
  <ul>
  <li><a href="#make-something-happen-make-a-lambda-expression" id="toc-make-something-happen-make-a-lambda-expression" class="nav-link" data-scroll-target="#make-something-happen-make-a-lambda-expression">Make Something Happen: Make a Lambda Expression</a></li>
  <li><a href="#code-analysis-lambda-expressions" id="toc-code-analysis-lambda-expressions" class="nav-link" data-scroll-target="#code-analysis-lambda-expressions">Code Analysis: Lambda Expressions</a></li>
  </ul></li>
  <li><a href="#iterator-functions-and-the-yield-statement" id="toc-iterator-functions-and-the-yield-statement" class="nav-link" data-scroll-target="#iterator-functions-and-the-yield-statement">Iterator Functions and the <code>yield</code> Statement</a>
  <ul>
  <li><a href="#make-something-happen-investigating-yield" id="toc-make-something-happen-investigating-yield" class="nav-link" data-scroll-target="#make-something-happen-investigating-yield">Make Something Happen: Investigating <code>yield</code></a></li>
  <li><a href="#create-a-test-data-generator-using-yield" id="toc-create-a-test-data-generator-using-yield" class="nav-link" data-scroll-target="#create-a-test-data-generator-using-yield">Create a Test Data Generator using <code>yield</code></a></li>
  <li><a href="#code-analysis-using-yield-to-generate-test-contacts" id="toc-code-analysis-using-yield-to-generate-test-contacts" class="nav-link" data-scroll-target="#code-analysis-using-yield-to-generate-test-contacts">Code Analysis: Using <code>yield</code> to Generate Test Contacts</a></li>
  </ul></li>
  <li><a href="#functions-with-an-arbitrary-number-of-arguments" id="toc-functions-with-an-arbitrary-number-of-arguments" class="nav-link" data-scroll-target="#functions-with-an-arbitrary-number-of-arguments">Functions with an Arbitrary Number of Arguments</a>
  <ul>
  <li><a href="#make-something-happen-investigating-arbitrary-arguments" id="toc-make-something-happen-investigating-arbitrary-arguments" class="nav-link" data-scroll-target="#make-something-happen-investigating-arbitrary-arguments">Make Something Happen: Investigating Arbitrary Arguments</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#modules-and-packages" id="toc-modules-and-packages" class="nav-link" data-scroll-target="#modules-and-packages">Modules and Packages</a>
  <ul>
  <li><a href="#python-modules" id="toc-python-modules" class="nav-link" data-scroll-target="#python-modules">Python Modules</a>
  <ul>
  <li><a href="#add-a-readme-function-to-btcinput" id="toc-add-a-readme-function-to-btcinput" class="nav-link" data-scroll-target="#add-a-readme-function-to-btcinput">Add a <code>readme</code> Function to BTCInput</a></li>
  <li><a href="#run-a-module-as-a-program" id="toc-run-a-module-as-a-program" class="nav-link" data-scroll-target="#run-a-module-as-a-program">Run a Module as a Program</a></li>
  <li><a href="#detect-when-a-module-is-executed-as-a-program" id="toc-detect-when-a-module-is-executed-as-a-program" class="nav-link" data-scroll-target="#detect-when-a-module-is-executed-as-a-program">Detect when a Module is Executed as a Program</a>
  <ul class="collapse">
  <li><a href="#make-something-happen-checking-program-context" id="toc-make-something-happen-checking-program-context" class="nav-link" data-scroll-target="#make-something-happen-checking-program-context">Make Something Happen: Checking Program Context</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#create-a-python-package" id="toc-create-a-python-package" class="nav-link" data-scroll-target="#create-a-python-package">Create a Python Package</a>
  <ul>
  <li><a href="#code-analysis-making-modules" id="toc-code-analysis-making-modules" class="nav-link" data-scroll-target="#code-analysis-making-modules">Code Analysis: Making Modules</a></li>
  </ul></li>
  <li><a href="#import-modules-from-packages" id="toc-import-modules-from-packages" class="nav-link" data-scroll-target="#import-modules-from-packages">Import Modules from Packages</a>
  <ul>
  <li><a href="#make-something-happen-use-classes-as-values" id="toc-make-something-happen-use-classes-as-values" class="nav-link" data-scroll-target="#make-something-happen-use-classes-as-values">Make Something Happen: Use Classes as Values</a></li>
  <li><a href="#code-analysis-references-to-classes" id="toc-code-analysis-references-to-classes" class="nav-link" data-scroll-target="#code-analysis-references-to-classes">Code Analysis: References to Classes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#program-testing" id="toc-program-testing" class="nav-link" data-scroll-target="#program-testing">Program Testing</a>
  <ul>
  <li><a href="#the-python-assert-statement" id="toc-the-python-assert-statement" class="nav-link" data-scroll-target="#the-python-assert-statement">The Python <code>assert</code> Statement</a>
  <ul>
  <li><a href="#code-analysis-python-assertions" id="toc-code-analysis-python-assertions" class="nav-link" data-scroll-target="#code-analysis-python-assertions">Code Analysis: Python Assertions</a></li>
  </ul></li>
  <li><a href="#the-python-unittest-module" id="toc-the-python-unittest-module" class="nav-link" data-scroll-target="#the-python-unittest-module">The Python <code>unittest</code> Module</a>
  <ul>
  <li><a href="#test-for-exceptions" id="toc-test-for-exceptions" class="nav-link" data-scroll-target="#test-for-exceptions">Test for Exceptions</a></li>
  </ul></li>
  <li><a href="#create-tests" id="toc-create-tests" class="nav-link" data-scroll-target="#create-tests">Create Tests</a></li>
  <li><a href="#exercise-complete-the-testing-of-stockitem" id="toc-exercise-complete-the-testing-of-stockitem" class="nav-link" data-scroll-target="#exercise-complete-the-testing-of-stockitem">Exercise: Complete the Testing of <code>StockItem</code></a></li>
  <li><a href="#exercise-refactoring-ride-selector-to-support-testing" id="toc-exercise-refactoring-ride-selector-to-support-testing" class="nav-link" data-scroll-target="#exercise-refactoring-ride-selector-to-support-testing">Exercise: Refactoring Ride Selector to Support Testing</a></li>
  </ul></li>
  <li><a href="#view-program-documentation" id="toc-view-program-documentation" class="nav-link" data-scroll-target="#view-program-documentation">View Program Documentation</a>
  <ul>
  <li><a href="#make-something-happen-explore-pydoc" id="toc-make-something-happen-explore-pydoc" class="nav-link" data-scroll-target="#make-something-happen-explore-pydoc">Make Something Happen: Explore <code>pydoc</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#questions-and-answers" id="toc-questions-and-answers" class="nav-link" data-scroll-target="#questions-and-answers">Questions and Answers</a></li>
  </ul>
<div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/flempriere/BeginToCodeWithPython/" target="_blank"><i class="bi bi-github"></i>GitHub Repo</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../02_AdvancedProgramming/09_UsingClasses/Chapter_09.html">Advanced Programming</a></li><li class="breadcrumb-item"><a href="../../02_AdvancedProgramming/12_PythonApplications/Chapter_12.html">Chapter 12: Python Applications</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Chapter 12: Python Applications</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<section id="advanced-functions" class="level3">
<h3 class="anchored" data-anchor-id="advanced-functions">Advanced Functions</h3>
<ul>
<li>Python functions are powerful and can be used in some interesting ways</li>
</ul>
<section id="references-to-functions" class="level4">
<h4 class="anchored" data-anchor-id="references-to-functions">References to Functions</h4>
<ul>
<li><p>We’ve seen that we can use references to functions much like variables</p></li>
<li><p>e.g.&nbsp;<code>map</code> in <a href="../../02_AdvancedProgramming/10_UseClassesToCreateActiveObjects/Chapter_10.html#the-python-map-function">Chapter 10</a> took a reference to a function and applied it element-wise to a list</p>
<ul>
<li>Another example was <a href="../../02_AdvancedProgramming/11_ObjectBasedSolutionDesign/Chapter_11.html#filter-on-tags"><code>filter</code></a></li>
</ul></li>
<li><p>Let’s explore this in more detail, consider the following code snippet (see <a href="./Examples/01_SimpleFunctionReferences/SimpleFunctionReferences.py">SimpleFunctionReferences.py</a>)</p>
<div id="1164541f" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Example 12.1 Simple Function References</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> func_1():</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Hello from function 1"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> func_2():</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Hello from function 2"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> func_1</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  x()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> func_2</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  x()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello from function 1
Hello from function 2</code></pre>
</div>
</div></li>
<li><p>We have two functions <code>func_1</code> and <code>func_2</code></p></li>
<li><p>We can assign the variable <code>x</code> to refer to and call each of these in turn</p>
<ul>
<li>The dereference operator <code>()</code> called on <code>x</code> resolves to the function it references</li>
</ul></li>
<li><p>The variable is effectively another name for the function</p></li>
<li><p>We still have to call it properly, e.g.&nbsp;(see <a href="./Examples/02_InvalidFunctionReferences/InvalidFunctionReferences.py">InvalidFunctionReferences.py</a>)</p>
<div id="5075bcca" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Example 12.2 Invalid Function References</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> func_1():</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Hello from func_1"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> func_1</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  x(<span class="dv">99</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[2]</span><span class="ansi-green-fg">, line 7</span>
<span class="ansi-green-fg">      4</span>     <span style="color:rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Hello from func_1</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">      6</span> x = func_1
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">7</span> <span class="ansi-yellow-bg">x</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">99</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-fg">TypeError</span>: func_1() takes 0 positional arguments but 1 was given</pre>
</div>
</div>
</div></li>
<li><p>The above generates an error as expected, because <code>x</code> is given an argument <code>99</code></p></li>
<li><p><code>func_1</code> takes no arguments</p></li>
<li><p>The error resolves to the original function name (here <code>func_1</code>)</p></li>
</ul>
<section id="use-function-references-in-the-btcinput-module" class="level5">
<h5 class="anchored" data-anchor-id="use-function-references-in-the-btcinput-module">Use Function References in the BTCInput Module</h5>
<ul>
<li><p>Recall back in <a href="../../01_ProgrammingFundamentals/07_UsingFunctions/Chapter_07.html">Chapter 7</a> we created a module for getting validated user input, <a href="../../01_ProgrammingFundamentals/07_UsingFunctions/Chapter_07.html#build-reusable-functions">BTCInput</a></p></li>
<li><p>We wrote code for reading integers and floating points with an additional ranged API</p></li>
<li><p>Both functions pretty much looked the same except one used <code>int()</code> to convert user input, the other used <code>float()</code></p></li>
<li><p>As a refresher here is <code>read_int</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> read_int(prompt):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>          <span class="cf">try</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>              <span class="co"># read in the number</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>              number_text <span class="op">=</span> read_text(prompt)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>              <span class="co"># perform conversion to int</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>              result <span class="op">=</span> <span class="bu">int</span>(number_text)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>          <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="st">"Please enter an integer"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>We could combine these two functions into one by using a function-valued variable</p></li>
<li><p>i.e.&nbsp;the function now accepts as a argument a function that takes in a string and converts the result to the appropriate type of number</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> read_number(prompt, number_converter):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">      Read and convert a user-provided number</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">      User is prompted for a number, and the resulting</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">      string is converted by the supplied `number_converter`</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">      function</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">      Parameters</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">      ----------</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">      prompt : str</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">          string to display to the user when asking for input</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">      number_converter : Callable[[[str], int | float]</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">          function that converts a string to a number. Must</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">          raise a `ValueError` on invalid input</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">      Returns</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">      -------</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">      int | float</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">          User input converted to a number</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">      """</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>          <span class="cf">try</span>:</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>              number_text <span class="op">=</span> read_text(prompt)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>              result <span class="op">=</span> number_converter(number_text)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>          <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="st">"Please enter a number"</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Now the call to <code>int</code> or <code>float</code> is instead replaced with a call to <code>number_converter</code></p></li>
<li><p>As part of the documentation we have to specify the required behaviour of the <code>number_converter</code> function</p>
<ul>
<li>Here we need it to be a one parameter function that accepts a string</li>
<li>The returned result should be an <code>int</code> or <code>float</code></li>
<li>Additionally a <em>key</em> requirement is that any failed conversion raises a <code>ValueError</code> so that the error-handling code in <code>read_number</code> catches it</li>
</ul></li>
<li><p><code>read_number</code> is a great function from our programmer perspective</p>
<ul>
<li>But not necessarily the cleanest implementation for a downstream user</li>
<li>They would still likely just want to call <code>read_int</code> or <code>read_float</code></li>
<li>We’ll provide wrapper functions <code>read_int</code> and <code>read_float</code> that pass the appropriate parameters through to <code>read_number</code>
<ul>
<li>We’ll make them match the old API for input so a downstream user sees no change</li>
</ul></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> read_float(prompt):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> read_number(prompt<span class="op">=</span>prompt, number_converter<span class="op">=</span><span class="bu">float</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p><em>Observe</em> when we pass a function we just pass the name, don’t use <code>()</code></p></li>
</ul>
</section>
<section id="code-analysis-function-references" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-function-references">Code Analysis: Function References</h5>
<p><em>Function references are complicated, work through the following questions to help your understanding</em></p>
<ol type="1">
<li><p><em>What is a function reference?</em></p>
<ul>
<li>One piece of a program telling another what to do</li>
<li><code>read_number</code> is given a prompt, and a function
<ul>
<li>The function tells <code>read_number</code> how to convert to a number</li>
</ul></li>
</ul></li>
<li><p><em>Why is using function references like this a good idea?</em></p>
<ul>
<li>Makes code more maintainable</li>
<li>Rather than having basically the same code in two places <code>read_int</code> and <code>read_float</code> we have it in one place</li>
<li>If we later need to modify the code, we can now do it in one place <code>read_number</code> rather than making sure both functions remain consistent</li>
</ul></li>
<li><p><em>If I wrote a function that converted Roman numerals into a numeric result, could I use <code>read_number</code> to read Roman Numbers?</em></p>
<ul>
<li><p>Yes, as long as that function matches the requirements for <code>number_converter</code></p></li>
<li><p>i.e.&nbsp;Only takes in a string</p>
<ul>
<li>Easy enough, this should be the roman numerals</li>
</ul></li>
<li><p>Returns either an <code>int</code> or <code>float</code></p>
<ul>
<li>Easy again Roman numerals convert to integers</li>
</ul></li>
<li><p>Raises a <code>ValueError</code> if an invalid Roman numeral is encountered</p></li>
<li><p>If we meet this API we could then use <code>read_number e.g.</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  number <span class="op">=</span> read_number(<span class="st">"Enter your age in roman numerals: "</span>, number_converter<span class="op">=</span>roman_converter)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>There is in fact nothing (other than the name <code>read_number</code>) that prevents us from using this function more generally</p></li>
<li><p>We could let <code>number_converter</code> be <em>any</em> function that takes a string argument, and returns a value, raising a <code>ValueError</code> on invalid input</p>
<ul>
<li>e.g.&nbsp;we could write <code>date_converter</code> that asks the user for a valid date string (e.g.&nbsp;<code>12/10/2017</code>)</li>
<li>Could convert this into a <code>date</code> object</li>
</ul></li>
<li><p>Function parameters are thus a form of abstraction</p>
<ul>
<li>We step away from a more concrete implementation (<code>read_int</code>, <code>read_float</code> etc)</li>
<li>Use a more general solution <code>read_number</code></li>
<li>We may then find that our solution is more general then we thought
<ul>
<li>e.g.&nbsp;<code>read_number</code> actually provides a structure to parse a lot of input depending on the provided parsing function (<code>number_converter</code>)</li>
<li>i.e.&nbsp;we might instead call <code>read_number</code> as <code>parse_input</code></li>
</ul></li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="exercise-write-a-roman-numeral-converter" class="level5">
<h5 class="anchored" data-anchor-id="exercise-write-a-roman-numeral-converter">Exercise: Write a Roman Numeral Converter</h5>
<p><em>Write a function that takes a string representing roman numerals and converts it to an integer. Make this function work with the</em> <code>read_number</code> <em>API</em></p>
<p>First lets set out some ground rules. The valid roman numerals are:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Symbol</strong></th>
<th>I</th>
<th>V</th>
<th>X</th>
<th>L</th>
<th>C</th>
<th>D</th>
<th>M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Value</strong></td>
<td>1</td>
<td>5</td>
<td>10</td>
<td>50</td>
<td>100</td>
<td>500</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p>The standard form for the roman numerals is given by,</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Thousands</th>
<th>Hundreds</th>
<th>Tens</th>
<th>Ones</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>M</td>
<td>C</td>
<td>X</td>
<td>I</td>
</tr>
<tr class="even">
<td>2</td>
<td>MM</td>
<td>CC</td>
<td>XX</td>
<td>II</td>
</tr>
<tr class="odd">
<td>3</td>
<td>MMM</td>
<td>CCC</td>
<td>XXX</td>
<td>III</td>
</tr>
<tr class="even">
<td>4</td>
<td></td>
<td>CD</td>
<td>XL</td>
<td>IV</td>
</tr>
<tr class="odd">
<td>5</td>
<td></td>
<td>D</td>
<td>L</td>
<td>V</td>
</tr>
<tr class="even">
<td>6</td>
<td></td>
<td>DC</td>
<td>LX</td>
<td>VI</td>
</tr>
<tr class="odd">
<td>7</td>
<td></td>
<td>DCC</td>
<td>LXX</td>
<td>VII</td>
</tr>
<tr class="even">
<td>8</td>
<td></td>
<td>DCCC</td>
<td>LXXX</td>
<td>VIII</td>
</tr>
<tr class="odd">
<td>9</td>
<td></td>
<td>CM</td>
<td>XC</td>
<td>IX</td>
</tr>
</tbody>
</table>
<p>To create a value we append the appropriate thousands, hundreds, tens, and ones.</p>
<p>e.g.&nbsp;<span class="math inline">\(3698 = MMM + DC + XC + VIII = MMMDCXCVIII\)</span></p>
<p>The basic conversion rules are as follows,</p>
<ol type="1">
<li><p>Read from left to right</p></li>
<li><p>Consider a “digit”.</p>
<ul>
<li>If the next digit is the same value or less, then it is added to the total
<ul>
<li>e.g.&nbsp;in <span class="math inline">\(II\)</span> and <span class="math inline">\(XI\)</span>, we read these as <span class="math inline">\(1 = 1\)</span>, and <span class="math inline">\(10 &gt; 1\)</span>, so the running total is <span class="math inline">\(1\)</span> and <span class="math inline">\(10\)</span> respectively</li>
</ul></li>
<li>If the next digit is a greater value, then we subtract from the total
<ul>
<li>e.g.&nbsp;in <span class="math inline">\(IV\)</span> we read this as <span class="math inline">\(1 &lt; 4\)</span>, so the running total is <span class="math inline">\(-1\)</span></li>
</ul></li>
<li>If there is no next digit, then the value is added</li>
</ul></li>
</ol>
<p>This is the basic ruleset, we could write a function to convert using these rules and be perfectly happy with it. However, in many modern use cases there are stricter syntax rules which for fun we’ll also implement, namely</p>
<ol type="1">
<li><span class="math inline">\(M\)</span>, <span class="math inline">\(C\)</span>, <span class="math inline">\(X\)</span>, <span class="math inline">\(I\)</span> can be repeated no more than three times sequentially, e.g.&nbsp;<span class="math inline">\(IIII\)</span> is invalid</li>
<li><span class="math inline">\(V\)</span>, <span class="math inline">\(L\)</span>, <span class="math inline">\(D\)</span> can’t be sequentially repeated, e.g.&nbsp;<span class="math inline">\(VV\)</span> is invalid</li>
<li>There can be no repeated sequence of the same value before a subtraction, i.e.&nbsp;<span class="math inline">\(IIV\)</span> is invalid because this should translate to <span class="math inline">\(5 - 2\)</span>.</li>
<li>There are precedence rules
<ul>
<li>“Tens”-like values can only precede smaller or the next two largest valued characters
<ul>
<li>e.g.&nbsp;<span class="math inline">\(IV\)</span> or <span class="math inline">\(IX\)</span> are valid, but not <span class="math inline">\(IM\)</span></li>
<li>e.g.&nbsp;<span class="math inline">\(XL\)</span> or <span class="math inline">\(XC\)</span> are valid, but not <span class="math inline">\(XD\)</span></li>
</ul></li>
<li>“Fives”-like can values can only precede smaller
<ul>
<li>e.g.&nbsp;<span class="math inline">\(VI\)</span> is valid, but not <span class="math inline">\(VX\)</span></li>
<li>e.g.&nbsp;<span class="math inline">\(LI\)</span> and <span class="math inline">\(LX\)</span> are valid, but not <span class="math inline">\(LD\)</span></li>
</ul></li>
</ul></li>
</ol>
<p>Let’s now plan out our algorithm, before considering valid syntax the basic structure will be as follows,</p>
<ol type="1">
<li><p>set a running total to <span class="math inline">\(0\)</span></p></li>
<li><p>Iterate over each character</p>
<ol type="1">
<li>Convert the character to their integer value</li>
<li>If the next character exists and it’s value is larger subtract the current value from the total</li>
<li>Else, add the current value</li>
</ol></li>
<li><p>Once all the characters have been processed return the total</p></li>
</ol>
<p>The easiest way to do this would be to use a dictionary lookup. We can directly convert the symbol to a value. Now let’s go one step further. We’ll define a lightweight class <code>RomanNumeral</code> this holds the symbol, the value and importantly also a set bookkeeping what other roman numerals this one is allowed to precede</p>
<div id="16878fa8" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RomanNumeral:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Lightweight class representing a roman numeral</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    symbol : str</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">        latin character symbolising the roman numeral</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">    value : int</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">        numeric value of a roman numeral</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    precedes : set[str]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">        set of strings representing other roman numerals this numeral may precede</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, symbol, value, precedes):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Create a new `RomanNumeral` Instance</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">        symbol : str</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">            latin character symbolising the roman numeral</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">        value : int</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">            numeric value of a roman numeral</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">        repetition_limit : int</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">            maximum number of times the same numeral can be repeated</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">        precedes : set[str]</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">            set of strings representing other roman numerals this numeral may precede</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.symbol <span class="op">=</span> symbol</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.precedes <span class="op">=</span> precedes</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> may_precede(<span class="va">self</span>, roman_numeral):</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Checks if this numeral may precede another</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">        roman_numeral : str</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">            character representing roman numeral to check if we can precede</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">        `True` if `self` may precede `roman_numeral` else, `False`</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> roman_numeral <span class="kw">in</span> <span class="va">self</span>.precedes</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>We define one helper function <code>may_precede</code> which is used to check if one symbol may precede another</li>
<li>We then define at the start of our function a dictionary containing the valid roman numerals</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roman_numeral_converter(number_string):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert a number written in roman numerals to an int</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    The string must be a valid roman numeral in `standard format`__</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    number_string : str</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">        A valid roman numeral expression</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Result of converting the roman numeral to an int</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Raised if `number_string` is not a valid roman numeral</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">    .. _standard format: https://en.wikipedia.org/wiki/Roman_numerals#Standard_form</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    roman_numerals <span class="op">=</span> {</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"I"</span>: RomanNumeral(<span class="st">"I"</span>, <span class="dv">1</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>}),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"V"</span>: RomanNumeral(<span class="st">"V"</span>, <span class="dv">5</span>, {<span class="st">"I"</span>}),</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X"</span>: RomanNumeral(<span class="st">"X"</span>, <span class="dv">10</span>, {<span class="st">"I"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>}),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"L"</span>: RomanNumeral(<span class="st">"L"</span>, <span class="dv">50</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>}),</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"C"</span>: RomanNumeral(<span class="st">"C"</span>, <span class="dv">100</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>, <span class="st">"M"</span>}),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D"</span>: RomanNumeral(<span class="st">"D"</span>, <span class="dv">500</span>, {<span class="st">"C"</span>, <span class="st">"L"</span>, <span class="st">"X"</span>, <span class="st">"V"</span>, <span class="st">"I"</span>}),</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"M"</span>: RomanNumeral(<span class="st">"M"</span>, <span class="dv">1000</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>}),</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_roman_numeral(numeral):</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns the `RomanNumeral` corresponding to the provided string</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">        numeral : str</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">            character representing a roman numeral digit</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">        RomanNumeral</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">            object describing the corresponding roman numeral</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">            The provided character is not a valid roman numeral digit</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> roman_numerals[numeral]</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(numeral, <span class="st">"is not a valid character for a roman numeral"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>The function <code>get_roman_numeral</code> is a helper function defined inside our converter
<ul>
<li>It wraps the error handling of getting the roman numeral from the dictionary</li>
<li>It’s main purpose is to convert a <code>KeyError</code> for an invalid character into a <code>ValueError</code> as required by the <code>read_number</code> interface</li>
</ul></li>
<li>Now lets work through our previous algorithm and add in the syntax checking at the appropriate steps</li>
</ul>
<ol type="1">
<li><p>set a running total to <span class="math inline">\(0\)</span>, and previous to <code>None</code></p></li>
<li><p>Iterate over each character</p>
<ol type="1">
<li>If the character doesn’t exist, a <code>ValueError</code> is raised</li>
<li>If this character is the same as the previous increment the number of repetitions
<ul>
<li>If it’s more than three, raise a <code>ValueError</code> for violation of the repetition rule</li>
<li>Else reset the number of repetitions</li>
</ul></li>
<li>Check if we’re at the end of the string
<ul>
<li>If so, add the current character’s value to the total and return</li>
<li>Else, attempt to get the next character’s roman numeral data
<ul>
<li>Again raise a <code>ValueError</code> if it doesn’t exist</li>
</ul></li>
</ul></li>
<li>Check that the current character is allowed to precede the next character
<ul>
<li>Raise a <code>ValueError</code> if it can’t</li>
</ul></li>
<li>Check the next character’s value is larger
<ul>
<li>If it is
<ul>
<li>Check if the number of repetitions is greater than <span class="math inline">\(1\)</span>
<ul>
<li>If it is, raise a <code>ValueError</code> since there can be no repetitions before a subtraction</li>
<li>Else subtract the value of the current character from the total</li>
</ul></li>
</ul></li>
<li>Else
<ul>
<li>Add the value to the current total</li>
</ul></li>
</ul></li>
<li>Set the previous to the current character</li>
</ol></li>
</ol>
<p>The complete implementation is given by,</p>
<div id="fc783a4a" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roman_numeral_converter(number_string):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert a number written in roman numerals to an int</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    The string must be a valid roman numeral in `standard format`__</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    number_string : str</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">        A valid roman numeral expression</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Result of converting the roman numeral to an int</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Raised if `number_string` is not a valid roman numeral</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">    .. _standard format: https://en.wikipedia.org/wiki/Roman_numerals#Standard_form</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    roman_numerals <span class="op">=</span> {</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"I"</span>: RomanNumeral(<span class="st">"I"</span>, <span class="dv">1</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>}),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"V"</span>: RomanNumeral(<span class="st">"V"</span>, <span class="dv">5</span>, {<span class="st">"I"</span>}),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X"</span>: RomanNumeral(<span class="st">"X"</span>, <span class="dv">10</span>, {<span class="st">"I"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>}),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"L"</span>: RomanNumeral(<span class="st">"L"</span>, <span class="dv">50</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>}),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"C"</span>: RomanNumeral(<span class="st">"C"</span>, <span class="dv">100</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>, <span class="st">"M"</span>}),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D"</span>: RomanNumeral(<span class="st">"D"</span>, <span class="dv">500</span>, {<span class="st">"C"</span>, <span class="st">"L"</span>, <span class="st">"X"</span>, <span class="st">"V"</span>, <span class="st">"I"</span>}),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"M"</span>: RomanNumeral(<span class="st">"M"</span>, <span class="dv">1000</span>, {<span class="st">"I"</span>, <span class="st">"V"</span>, <span class="st">"X"</span>, <span class="st">"L"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>}),</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_roman_numeral(numeral):</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns the `RomanNumeral` corresponding to the provided string</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">        numeral : str</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">            character representing a roman numeral digit</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">        RomanNumeral</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">            object describing the corresponding roman numeral</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co">            The provided character is not a valid roman numeral digit</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> roman_numerals[numeral]</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(numeral, <span class="st">"is not a valid character for a roman numeral"</span>)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    previous <span class="op">=</span> <span class="va">None</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    n_reps <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    number_string <span class="op">=</span> number_string.upper().strip()</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    max_repeats <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ch <span class="kw">in</span> <span class="bu">enumerate</span>(number_string):</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the roman numeral associated with the next character</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        numeral <span class="op">=</span> get_roman_numeral(ch)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> numeral.value <span class="op">==</span> previous:</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># check that we haven't repeated this numeral too many times</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>            n_reps <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n_reps <span class="op">&gt;</span> max_repeats:</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>                    ch,</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"repeated </span><span class="sc">{0}</span><span class="st"> times, maximum is </span><span class="sc">{1}</span><span class="st">"</span>.<span class="bu">format</span>(n_reps, max_repeats),</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>            n_reps <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> <span class="bu">len</span>(number_string):  <span class="co"># reached the end and stop</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> total <span class="op">+</span> numeral.value</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            next_numeral <span class="op">=</span> get_roman_numeral(number_string[i <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> numeral.may_precede(next_numeral.symbol):</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Invalid roman numeral: </span><span class="sc">{0}</span><span class="st"> may not precede </span><span class="sc">{1}</span><span class="st">"</span>.<span class="bu">format</span>(</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>                        numeral.symbol, next_numeral.symbol</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if next is larger perform subtraction if valid</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_numeral.value <span class="op">&gt;</span> numeral.value:</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> n_reps <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Invalid roman numeral: cannot repeat digits for subtraction"</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>                    total <span class="op">-=</span> numeral.value</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> numeral.value</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>        previous <span class="op">=</span> numeral.value</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Which we can see on some sample valid inputs,</p>
<div id="a22739b8" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"I: Expected: 1, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(roman_numeral_converter(<span class="st">"I"</span>)))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"V: Expected: 5, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(roman_numeral_converter(<span class="st">"V"</span>)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"X: Expected: 10, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(roman_numeral_converter(<span class="st">"X"</span>)))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"II: Expected: 2, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(roman_numeral_converter(<span class="st">"II"</span>)))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"III: Expected: 3, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(roman_numeral_converter(<span class="st">"III"</span>)))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MMMDCXCVIII: Expected: 3698, Result: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        roman_numeral_converter(<span class="st">"MMMDCXCVIII"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>I: Expected: 1, Received: 1
V: Expected: 5, Received: 5
X: Expected: 10, Received: 10
II: Expected: 2, Received: 2
III: Expected: 3, Received: 3
MMMDCXCVIII: Expected: 3698, Result: 3698</code></pre>
</div>
</div>
<p>And on a sample invalid input,</p>
<div id="51963617" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"VV: Expected: Invalid Number, Received: </span><span class="sc">{0}</span><span class="st">"</span>.<span class="bu">format</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            roman_numeral_converter(<span class="st">"VV"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[6]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> <span style="color:rgb(0,135,0)">print</span>(
<span class="ansi-green-fg">      2</span>     <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">VV: Expected: Invalid Number, Received: </span><span style="font-weight:bold;color:rgb(175,95,135)">{0}</span><span class="ansi-yellow-fg">"</span>.format(
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span>         <span class="ansi-yellow-bg">roman_numeral_converter</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">VV</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      4</span>     )
<span class="ansi-green-fg">      5</span> )

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[4]</span><span class="ansi-green-fg">, line 84</span>, in <span class="ansi-cyan-fg">roman_numeral_converter</span><span class="ansi-blue-fg">(number_string)</span>
<span class="ansi-green-fg">     81</span> next_numeral = get_roman_numeral(number_string[i + <span class="ansi-green-fg">1</span>])
<span class="ansi-green-fg">     83</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> numeral.may_precede(next_numeral.symbol):
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">84</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg">     85</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Invalid roman numeral: </span><span style="font-weight:bold;color:rgb(175,95,135)">{0}</span><span class="ansi-yellow-fg"> may not precede </span><span style="font-weight:bold;color:rgb(175,95,135)">{1}</span><span class="ansi-yellow-fg">"</span>.format(
<span class="ansi-green-fg">     86</span>             numeral.symbol, next_numeral.symbol
<span class="ansi-green-fg">     87</span>         )
<span class="ansi-green-fg">     88</span>     )
<span class="ansi-green-fg">     89</span> <span style="font-style:italic;color:rgb(95,135,135)"># if next is larger perform subtraction if valid</span>
<span class="ansi-green-fg">     90</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> next_numeral.value &gt; numeral.value:

<span class="ansi-red-fg">ValueError</span>: Invalid roman numeral: V may not precede V</pre>
</div>
</div>
</div>
<p>A more comprehensive set of tests can be found in the <a href="./Exercises/01_RomanNumeralConverter/RomanNumeralConverter.py">complete program</a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Trusting vs Checking the Input</strong></p>
<p>You can see that compared to the simple algorithm outlined for the case were we assumed the input was valid, the final algorithm is a lot longer. This is most due to it performing syntax validation at the same time as it calculates the result.</p>
<p>This is a common philosophical argument. Should <code>roman_numeral_converter</code> validate it’s input. In principle we could write a function <code>validate_roman_numeral</code> which would check that the string is valid. Doing it this way means we could make <code>roman_numeral_converter</code> itself quite lean. This has the downside that we would need to make two passes through the string now. The first to validate and the second to convert it.</p>
<p>There are two sides here, the safer version of <code>roman_numeral_converter</code> can be used anywhere and always ensures it’s input is valid. This comes at the cost that for valid input we are doing extra work checking it. Thus it’s a tradeoff, if we expect to receive valid input then we can use the fast version (and if there is perhaps a separate path that can supply invalid input we might use <code>validate_roman_numeral</code>), but if not we should use a protected version.</p>
<p>Since our implementation is designed to be for parsing user input, I’ve combined the code into one function. In the future if the design requirements changed I might revisit this choice</p>
</div>
</div>
<p>There’s another more simple implementation of this. If we restrict ourselves as above to the standard form then we can only represent <span class="math inline">\(1\)</span> to <span class="math inline">\(3999\)</span>, and each has a unique representation. Thus we could create an explicit conversion dictionary that makes the string representation to the integer representation. This is a form of lookup table. We set the lookup table to be generated when the roman numeral conversion code is loaded.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 12.1b Roman Numeral Converter</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a function that converts strings of roman numerals to an integer</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This implementation uses a lookup table</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> BTCInput</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>thousands <span class="op">=</span> {<span class="st">""</span>: <span class="dv">0</span>, <span class="st">"M"</span>: <span class="dv">1000</span>, <span class="st">"MM"</span>: <span class="dv">2000</span>, <span class="st">"MMM"</span>: <span class="dv">3000</span>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>hundreds <span class="op">=</span> {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">""</span>: <span class="dv">0</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C"</span>: <span class="dv">100</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CC"</span>: <span class="dv">200</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CCC"</span>: <span class="dv">300</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CD"</span>: <span class="dv">400</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D"</span>: <span class="dv">500</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DC"</span>: <span class="dv">600</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DCC"</span>: <span class="dv">700</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DCCC"</span>: <span class="dv">800</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CM"</span>: <span class="dv">900</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>tens <span class="op">=</span> {</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">""</span>: <span class="dv">0</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X"</span>: <span class="dv">10</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XX"</span>: <span class="dv">20</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XXX"</span>: <span class="dv">30</span>,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XL"</span>: <span class="dv">40</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L"</span>: <span class="dv">50</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LX"</span>: <span class="dv">60</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LXX"</span>: <span class="dv">70</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VXXX"</span>: <span class="dv">80</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XC"</span>: <span class="dv">90</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> {</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">""</span>: <span class="dv">0</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"I"</span>: <span class="dv">1</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"II"</span>: <span class="dv">2</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"III"</span>: <span class="dv">3</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IV"</span>: <span class="dv">4</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"V"</span>: <span class="dv">5</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VI"</span>: <span class="dv">6</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VII"</span>: <span class="dv">7</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VIII"</span>: <span class="dv">8</span>,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IX"</span>: <span class="dv">9</span>,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>roman_numeral_dictionary <span class="op">=</span> {}</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> itertools.product(</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    thousands.items(), hundreds.items(), tens.items(), ones.items()</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    key <span class="op">=</span> <span class="st">""</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> symbol_value_pair <span class="kw">in</span> p:</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>        key <span class="op">+=</span> symbol_value_pair[<span class="dv">0</span>]</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>        value <span class="op">+=</span> symbol_value_pair[<span class="dv">1</span>]</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    roman_numeral_dictionary[key] <span class="op">=</span> value</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>roman_numeral_dictionary.pop(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We define component dictionaries for each valid roman numeral that is purely a thousands, hundreds, tens or singles expression. Any valid expression is then given by the concatenation of the strings and addition of the values. The valid expressions are thus all possible pairings which is given by the cartesian product of all the dictionaries. (We add the empty string as a key to give a <span class="math inline">\(0\)</span> value to represent not choosing from a given set)</p>
<p>Once we generated all the possible pairings we then build the dictionary by iterating over the pairings and concatenating the string components to create the string. The value is similarly created by adding all the value components.</p>
<p>Our actual implementation of the roman numeral lookup parser is simple, we normalise the input (convert to upper case and strip whitespace), and then simply try to get the value from the dictionary. As before we convert <code>KeyError</code> for missing values to <code>ValueError</code> to comply with the <code>read_number</code> interface</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roman_numeral_converter(number_string):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert a number written in roman numerals to an int</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    The string must be a valid roman numeral in `standard format`__</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    number_string : str</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">        A valid roman numeral expression</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Result of converting the roman numeral to an int</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Raised if `number_string` is not a valid roman numeral</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">    .. _standard format: https://en.wikipedia.org/wiki/Roman_numerals#Standard_form</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> roman_numeral_dictionary[number_string.upper().strip()]</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"</span><span class="sc">{0}</span><span class="st"> is not a valid roman numeral"</span>.<span class="bu">format</span>(number_string))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If we wanted to make this even faster, we could have used a python program to generate the dictionary, print that out and copy the lookup table into the file. However for demonstration purposes seeing how it’s generated is useful</p>
<p>This implementation is found in <a href="../12_PythonApplications/Exercises/01_RomanNumeralConverter/RomanNumeralLookupTable.py">RomanNumeralLookupTable.py</a> and passes all the same tests as the previous one</p>
</section>
</section>
<section id="build-lists-of-function-references" class="level4">
<h4 class="anchored" data-anchor-id="build-lists-of-function-references">Build Lists of Function References</h4>
<ul>
<li>Function references can be used as any other references</li>
<li>For example, we can create collections</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 12.3 Robot Dancer</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrates creating collections of function references</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward():</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Robot moving forward"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> back():</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Robot moving backwards"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> left():</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Robot moving left"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> right():</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"robot moving right"</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>dance_moves <span class="op">=</span> [forward, back, left, right]</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dance starting"</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> move <span class="kw">in</span> dance_moves:</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    move()</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dance over"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="2c551fc6" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code>Dance starting
Robot moving forward
Robot moving backwards
Robot moving left
robot moving right
Dance over</code></pre>
</div>
</div>
<ul>
<li>We define a set of functions</li>
<li>Then create a collection referencing them</li>
<li>Here they represent a robot performing a sequence of dance moves</li>
<li>A longer program can then be created by increasing the length of the function</li>
</ul>
</section>
<section id="use-lambda-expressions" class="level4">
<h4 class="anchored" data-anchor-id="use-lambda-expressions">Use Lambda Expressions</h4>
<ul>
<li>A lambda function is like a tiny one line function</li>
<li>Has the following structure</li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">block-beta
    columns 4
    space
    title["Breakdown of an Lambda Expression"]:2
    space

    block:LambdaStatement
    columns 1
        lambda["lambda"]
        lambdaDescr["(start of the lambda)"]
    end

    block:Arguments
    columns 1
        argument["arguments"]
        argumentDescr["(comma-separated list of arguments values)"]
    end

    block:Colon
    columns 1
        colon[":"]
        colonDescr["colon"]
    end

    block:Expression
    columns 1
        expression["expression"]
        expressionDescr["(expression to be evaluated)"]
    end

classDef BG stroke:transparent, fill:transparent
class title BG
class argument BG
class argumentDescr BG
class colon BG
class colonDescr BG
class lambda BG
class lambdaDescr BG
class expression BG
class expressionDescr BG
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Colon separates arguments (supplied values) from expression (results coming out), e.g.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> increment(x):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Is equivalent to,</li>
</ul>
<div id="68505ddf" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>increment <span class="op">=</span> <span class="kw">lambda</span> x : x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(increment(<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2</code></pre>
</div>
</div>
<ul>
<li>We can see this is called like a function, and returns the increment of the provided value</li>
</ul>
<section id="make-something-happen-make-a-lambda-expression" class="level5">
<h5 class="anchored" data-anchor-id="make-something-happen-make-a-lambda-expression">Make Something Happen: Make a Lambda Expression</h5>
<p><em>Work through the following steps to understand lambda expressions</em></p>
<ol type="1">
<li><p><em>Enter the following statement</em></p>
<div id="7d09c7a9" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> numbers <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>This creates some sample data to work with</li>
<li>Let’s say we want to increment very value of <code>numbers</code> by <span class="math inline">\(1\)</span></li>
<li>We could do this normally by defining a function and using <code>map</code></li>
</ul></li>
<li><p><em>Define a function</em> <code>increment</code> <em>as below, and run the following code</em></p>
<div id="0e932622" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> increment(x):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> new_numbers <span class="op">=</span> <span class="bu">map</span>(increment, numbers)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>(<span class="bu">list</span>(new_numbers))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
<ul>
<li>This works, but has two downsides</li>
<li>One have to name and define a function <code>increment</code></li>
<li>The function then exists for the remaining lifetime of the scope</li>
<li>This is a natural use for a lambda
<ul>
<li>No need to associate a name</li>
<li>existence is restricted to the use of <code>map</code></li>
</ul></li>
</ul></li>
<li><p><em>Repeat the previous steps, but use a lambda as below instead of an explicit function</em></p>
<div id="1241f703" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a> new_numbers <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x : x <span class="op">+</span> <span class="dv">1</span>, numbers)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>(<span class="bu">list</span>(new_numbers))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
<ul>
<li>The same behaviour is observed</li>
<li>But the code is more compact, and the behaviour is localised to the map</li>
</ul></li>
<li><p><em>Create the following lambda</em></p>
<div id="9c40afa8" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a> adder <span class="op">=</span> <span class="kw">lambda</span> x, y : x <span class="op">+</span> y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>addr</code> is a lambda expression that takes two arguments and adds them</li>
<li>We can now use the lambda as we want</li>
</ul></li>
<li><p><em>Run the following expressions to demonstrate using the lambda</em></p>
<div id="11027c1a" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a> adder(<span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>3</code></pre>
</div>
</div>
<ul>
<li>We can see this evaluates like any other function call</li>
</ul></li>
</ol>
</section>
<section id="code-analysis-lambda-expressions" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-lambda-expressions">Code Analysis: Lambda Expressions</h5>
<p><em>Consider the following questions about lambda expressions</em></p>
<ol type="1">
<li><p><em>What are lambda expressions?</em></p>
<ul>
<li>Can think of them as data representing an operation to perform</li>
<li>Rather than passing a function reference we create a <em>value</em> containing that behaviour</li>
<li>lambda expressions are sometimes called <em>anonymous functions</em>
<ul>
<li>They are functional behaviour without a named handle</li>
</ul></li>
</ul></li>
<li><p><em>Must I use lambda expressions in my programs?</em></p>
<ul>
<li>No</li>
<li>Lambdas don’t add any new behaviour over defining functions</li>
<li>However, they can make code cleaner or more compact</li>
<li>They are especially useful for defining small temporary functions that are passed to things like <code>map</code> and <code>filter</code></li>
</ul></li>
<li><p><em>Can a lambda function contain more than one action?</em></p>
<ul>
<li>No</li>
<li>The active part of a lambda function is a single expression that calculates a return value</li>
</ul></li>
<li><p><em>Can a lambda expression accept multiple arguments?</em></p>
<ul>
<li>Yes, we saw this with the <code>addr</code> lambda which took two arguments</li>
<li>Lambda’s can also technically take no arguments</li>
</ul></li>
<li><p><em>Can a lambda expression make decisions?</em></p>
<ul>
<li><p>A lambda could return <code>True</code> or <code>False</code></p></li>
<li><p>Can then use as a condition in programs</p></li>
<li><p>We can define <em>conditional expressions</em> to choose a value to return</p>
<div id="8b43bf40" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  hour <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"morning"</span> <span class="cf">if</span> hour <span class="op">&lt;</span> <span class="dv">12</span> <span class="cf">else</span> <span class="st">"afternoon"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>morning</code></pre>
</div>
</div></li>
<li><p>Functions as an in line if statement</p>
<ul>
<li>First value returned if condition evaluates true, else false</li>
</ul></li>
</ul></li>
</ol>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">        block-beta
            columns 5
            space
            title["Breakdown of a Conditional Expression"]:3
            space

            block:ValueStatement
            columns 1
                value["value"]
                valueDescr["(value of expression if true)"]
            end

            block:If
            columns 1
                if["if"]
            end

            block:Condition
            columns 1
                condition["condition"]
                conditionDescr["(True or False condition)"]
            end

            block:Else
            columns 1
                else["else"]
            end

            block:Value2
            columns 1
                value2["value"]
                value2Descr["(value of expression if true)"]
            end

        classDef BG stroke:transparent, fill:transparent
        class title BG
        class value BG
        class valueDescr BG
        class if BG
        class else BG
        class colon BG
        class colonDescr BG
        class condition BG
        class conditionDescr BG
        class value2 BG
        class value2Descr BG
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<pre><code>- Conditional expressions can be used anywhere an expression can be
- A lambda can thus return a conditional expression</code></pre>
<div id="6f7dbafe" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>    day_prompt <span class="op">=</span> <span class="kw">lambda</span> hour : <span class="st">"morning"</span> <span class="cf">if</span> hour <span class="op">&lt;</span> <span class="dv">12</span> <span class="cf">else</span> <span class="st">"afternoon"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="sc">{0}</span><span class="st"> is during the day: </span><span class="sc">{1}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="dv">8</span>, day_prompt(<span class="dv">8</span>)))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="sc">{0}</span><span class="st"> is during the day: </span><span class="sc">{1}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="dv">13</span>, day_prompt(<span class="dv">13</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>8 is during the day: morning
13 is during the day: afternoon</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Don’t worry if you don’t get lambda expressions the first time you see them</strong></p>
<p>Lambda expressions can be difficult to understand at first. They blur the lines between data and program code. Our previous programs seperate the data (as values) from the code (as functions). A lambda expression is code as data. Sometimes it’s useful to be able to pass behaviours around as data and lambdas provide a way to do that</p>
</div>
</div>
</section>
</section>
<section id="iterator-functions-and-the-yield-statement" class="level4">
<h4 class="anchored" data-anchor-id="iterator-functions-and-the-yield-statement">Iterator Functions and the <code>yield</code> Statement</h4>
<ul>
<li><p>Recall python has a concept of an <em>iterator</em></p></li>
<li><p>Generally when we encounter iterators we work through the values they generate</p></li>
<li><p><code>range</code> is an example, e.g.&nbsp;creating a sequence of numbers</p>
<div id="76291cc2" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(i)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
2
3
4</code></pre>
</div>
</div></li>
<li><p><code>range</code> returns a result that is an iterator producing the values <span class="math inline">\(1\)</span> to <span class="math inline">\(4\)</span>.</p></li>
<li><p>When then <em>consume</em> the values to print them in order</p>
<ul>
<li>Remember <code>range</code> does not include the end point</li>
</ul></li>
<li><p>Iterators can be made by using the <code>yield</code> keyword</p>
<ul>
<li>A <code>yield</code> is like a function <code>return</code> but the function remembers its state</li>
<li>functions that <code>yield</code> can be used to create a sequence of values</li>
</ul></li>
</ul>
<section id="make-something-happen-investigating-yield" class="level5">
<h5 class="anchored" data-anchor-id="make-something-happen-investigating-yield">Make Something Happen: Investigating <code>yield</code></h5>
<p><em>Use an interpreter to work through the following steps to learn about the</em> <code>yield</code> <em>keyword</em></p>
<ol type="1">
<li><p><em>Enter the following into the interpreter</em></p>
<div id="0276300c" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> my_yield():</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="cf">yield</span> <span class="dv">1</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">yield</span> <span class="dv">2</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">yield</span> <span class="dv">3</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>     <span class="cf">yield</span> <span class="dv">4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>The function <code>my_yield</code> contains four yield statements</li>
<li>Each returns a value</li>
<li>Let’s see what happens when we now loop over the function</li>
</ul></li>
<li><p><em>Define and run the following loop</em></p>
<div id="941b70a2" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> i <span class="kw">in</span> my_yield():</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(i)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
2
3
4</code></pre>
</div>
</div>
<ul>
<li>We can see that the value returned by each <code>yield</code> is printed out in turn</li>
<li>We could also convert this to a list</li>
</ul></li>
<li><p><em>Define and run the following</em></p>
<div id="7f8ef27c" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a> <span class="bu">list</span>(my_yield())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>[1, 2, 3, 4]</code></pre>
</div>
</div>
<ul>
<li><code>list</code> accepts an iterator and converts it to list</li>
</ul></li>
</ol>
</section>
<section id="create-a-test-data-generator-using-yield" class="level5">
<h5 class="anchored" data-anchor-id="create-a-test-data-generator-using-yield">Create a Test Data Generator using <code>yield</code></h5>
<ul>
<li><code>yield</code> can be used to make a flexible test data generator
<ul>
<li>e.g.&nbsp;for <a href="../../02_AdvancedProgramming/10_UseClassesToCreateActiveObjects/Chapter_10.html#create-a-time-tracker">Time Tracker</a></li>
<li>e.g.&nbsp;If we want to do load testing for when we have hundreds of contacts rather than say tens</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Using a program to create test data is a great idea</strong></p>
<p>If you find yourself entering lots of test data into your programs, you should write a program to do the work for you. Remember that computers were created to spare us from drudgery, not create more of it</p>
</div>
</div>
<div id="3fa3835c" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 12.5 Test Contact Generator</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrates using yield to generate test Contacts for the</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># time tracker application</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Contact:</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, address, telephone):</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.address <span class="op">=</span> address</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.telephone <span class="op">=</span> telephone</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hours_worked <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_test_contacts():</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        phone_number <span class="op">=</span> <span class="dv">1000000</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        hours_worked <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> first_name <span class="kw">in</span> (<span class="st">"Rob"</span>, <span class="st">"Mary"</span>, <span class="st">"Jenny"</span>, <span class="st">"Davis"</span>, <span class="st">"Chris"</span>, <span class="st">"Imogen"</span>):</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> second_name <span class="kw">in</span> (<span class="st">"Miles"</span>, <span class="st">"Brown"</span>):</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>                full_name <span class="op">=</span> first_name <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> second_name</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>                address <span class="op">=</span> full_name <span class="op">+</span> <span class="st">"'s house"</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>                telephone <span class="op">=</span> <span class="bu">str</span>(phone_number)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                telephone <span class="op">=</span> telephone <span class="op">+</span> <span class="bu">str</span>(<span class="dv">1</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>                contact <span class="op">=</span> Contact(full_name, address, telephone)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>                contact.hours_worked <span class="op">=</span> hours_worked</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>                hours_worked <span class="op">=</span> hours_worked <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> contact</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>The test data generation is implemented as a static method
<ul>
<li>Let’s us access and set hidden attributes on the <code>Contact</code> class</li>
</ul></li>
<li>Implementation (<code>make_test_contacts</code>) cycles through a set of first and last names
<ul>
<li>Contacts are then generated with a generated name, a simplified address (we simply append <code>'s house'</code> to the end of the name), a telephone number and <code>hours_worked</code></li>
<li>Each iteration increases the telephone number and hours worked by one</li>
</ul></li>
<li>We can the use the method as a iterator, see</li>
</ul>
<div id="b25119ee" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> contact <span class="kw">in</span> Contact.create_test_contacts():</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(contact.name)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>contacts <span class="op">=</span> <span class="bu">list</span>(Contact.create_test_contacts())</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> contact <span class="kw">in</span> contacts:</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span><span class="sc">{0}</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="st">Address: </span><span class="sc">{1}</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="st">Telephone: </span><span class="sc">{2}</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="st">Hours worked: </span><span class="sc">{3}</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>.<span class="bu">format</span>(contact.name, contact.address, contact.telephone, contact.hours_worked)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rob Miles
Rob Brown
Mary Miles
Mary Brown
Jenny Miles
Jenny Brown
Davis Miles
Davis Brown
Chris Miles
Chris Brown
Imogen Miles
Imogen Brown
Rob Miles
Address: Rob Miles's house
Telephone: 10000001
Hours worked: 0

Rob Brown
Address: Rob Brown's house
Telephone: 10000001
Hours worked: 1

Mary Miles
Address: Mary Miles's house
Telephone: 10000001
Hours worked: 2

Mary Brown
Address: Mary Brown's house
Telephone: 10000001
Hours worked: 3

Jenny Miles
Address: Jenny Miles's house
Telephone: 10000001
Hours worked: 4

Jenny Brown
Address: Jenny Brown's house
Telephone: 10000001
Hours worked: 5

Davis Miles
Address: Davis Miles's house
Telephone: 10000001
Hours worked: 6

Davis Brown
Address: Davis Brown's house
Telephone: 10000001
Hours worked: 7

Chris Miles
Address: Chris Miles's house
Telephone: 10000001
Hours worked: 8

Chris Brown
Address: Chris Brown's house
Telephone: 10000001
Hours worked: 9

Imogen Miles
Address: Imogen Miles's house
Telephone: 10000001
Hours worked: 10

Imogen Brown
Address: Imogen Brown's house
Telephone: 10000001
Hours worked: 11
</code></pre>
</div>
</div>
</section>
<section id="code-analysis-using-yield-to-generate-test-contacts" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-using-yield-to-generate-test-contacts">Code Analysis: Using <code>yield</code> to Generate Test Contacts</h5>
<p><em>Answer the following questions about the previous bits of code</em></p>
<ol type="1">
<li><p><em>Why is</em> <code>create_test_contacts</code> <em>a static method?</em></p>
<ul>
<li>We don’t want to ask a specific <code>Contact</code> for test information</li>
<li>We want to generate a <em>new</em> <code>Contact</code> as test data</li>
<li>Belongs with the <code>Contact</code> class itself</li>
</ul></li>
<li><p><em>What is the difference between</em> <code>yield</code> <em>and</em> <code>return</code><em>?</em></p>
<ul>
<li><p><code>yield</code> pauses function execution and bookmarks where it is, returning the <code>yield</code></p>
<ul>
<li>Subsequent call follows on from this position</li>
</ul></li>
<li><p><code>return</code> returns the value and ends function execution</p>
<ul>
<li>All subsequent executions will begin from the start of the function</li>
</ul></li>
<li><p><code>return</code> does not support iteration</p></li>
<li><p>Consider the following,</p>
<div id="02f4515c" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> yield_return():</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">yield</span> <span class="dv">1</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">yield</span> <span class="dv">2</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">3</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">yield</span> <span class="dv">4</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> yield_return():</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(i)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
2</code></pre>
</div>
</div></li>
<li><p>The iteration only prints <code>1</code> and <code>2</code> since the third iteration encounters a <code>return</code> which ends the iteration (and is not included)</p>
<ul>
<li>We never reach the <code>yield 4</code> statement</li>
</ul></li>
</ul></li>
<li><p><em>Does a function using</em> <code>yield</code> <em>have to</em> <code>return</code><em>?</em></p>
<ul>
<li><p>No</p></li>
<li><p>An iterator using <code>yield</code> could in theory run forever, e.g.</p>
<div id="c1630dee" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> forever_tens():</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>          <span class="cf">yield</span> result</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>          result <span class="op">=</span> result <span class="op">+</span> <span class="dv">10</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li><p>This creates an infinitely long iteration</p></li>
<li><p>Each value is ten times larger than before</p>
<div id="ca355596" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> result <span class="kw">in</span> forever_tens():</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(result)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> result <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
10
20
30
40
50
60
70
80
90
100
110</code></pre>
</div>
</div></li>
<li><p>Loop continues until the result returned by the iterator is too large</p></li>
</ul></li>
<li><p><em>What happens to local variables in a yielded function?</em></p>
<ul>
<li>Local variables are retained when the function yields a result</li>
<li>e.g.&nbsp;<code>forever_tens()</code> relies on the value of <code>result</code> being preserved between calls to generate the continuing sequence</li>
</ul></li>
</ol>
</section>
</section>
<section id="functions-with-an-arbitrary-number-of-arguments" class="level4">
<h4 class="anchored" data-anchor-id="functions-with-an-arbitrary-number-of-arguments">Functions with an Arbitrary Number of Arguments</h4>
<ul>
<li><p>We’ve seen functions like <code>print</code> which seem to accept a variety of arguments, e.g.</p>
<div id="eeff8213" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"a"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"a"</span>, <span class="st">"b"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>a
a b</code></pre>
</div>
</div></li>
<li><p>When we’ve written functions, we’ve been able to define <em>optional</em> or <em>default</em>-valued parameters</p></li>
<li><p>However, we’ve always had to specify the number of variables</p></li>
<li><p><code>print</code> accepts an <em>arbitrary</em> number of arguments</p></li>
</ul>
<section id="make-something-happen-investigating-arbitrary-arguments" class="level5">
<h5 class="anchored" data-anchor-id="make-something-happen-investigating-arbitrary-arguments">Make Something Happen: Investigating Arbitrary Arguments</h5>
<p><em>Let’s learn about arbitrary-argument functions by working through the following steps in the interpreter</em></p>
<ol type="1">
<li><p><em>Define the following function</em></p>
<div id="1b861e12" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> add_function(x, y):</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> x <span class="op">+</span> y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>This is a function that adds two numbers</p>
<div id="ea2ca163" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>  add_function(<span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>3</code></pre>
</div>
</div></li>
<li><p>However if we tried to add <em>three</em> numbers,</p>
<div id="66287c21" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>  add_function(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[28]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">add_function</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">2</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">3</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-fg">TypeError</span>: add_function() takes 2 positional arguments but 3 were given</pre>
</div>
</div>
</div></li>
<li><p>We see that we get an error because there’s a mismatch between the number of arguments required and supplied</p></li>
</ul></li>
</ol>
<ul>
<li><p>It might make sense to have a function like <code>add_function</code> that accepts an arbitrary number of numbers and adds them all together</p></li>
<li><p>We can specify to a python function that an arbitrary number of arguments are accepted with the <code>*</code> identifier, e.g.</p>
<div id="0e842ada" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> add_function(<span class="op">*</span>values):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          total <span class="op">=</span> total <span class="op">+</span> value</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> total</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li><p>The above could accept any number of arguments, including zero</p>
<div id="d9d6d543" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function())</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function(<span class="dv">1</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
1
3
6</code></pre>
</div>
</div></li>
<li><p>A parameter indicating an arbitrary number of parameters may be preceded by normal parameters</p></li>
<li><p>For example, if we wanted to force the <code>add_function</code> to receive at least one value</p>
<div id="11433c19" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> add_function(start, <span class="op">*</span>values):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>      total <span class="op">=</span> start</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>          total <span class="op">=</span> total <span class="op">+</span> value</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> total</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function(<span class="dv">1</span>))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(add_function(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
3</code></pre>
</div>
</div></li>
<li><p>If we try and pass nothing to the above, we get an error</p>
<div id="1f3e3d8c" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>      add_function()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[32]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">add_function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-fg">TypeError</span>: add_function() missing 1 required positional argument: 'start'</pre>
</div>
</div>
</div></li>
<li><p>What happens if the user already has an arbitrary number of values stored in a collection?</p></li>
<li><p>How do they translate a tuple say <code>x = (1,2,3, 4)</code> into the correct call structure?</p>
<ul>
<li>Can’t just write <code>add_function(x)</code> since that will treat <code>x</code> as one variable</li>
</ul></li>
<li><p>Need a way to <em>unpack</em> the contents</p></li>
<li><p>This is provided by the <code>*</code> operator</p>
<ul>
<li>Unpacks a collection</li>
</ul></li>
<li><p>For example,</p>
<div id="45b82255" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>  numbers <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  add_function(<span class="dv">0</span>, <span class="op">*</span>numbers)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>10</code></pre>
</div>
</div></li>
<li><p>Each element in numbers is <em>unpacked</em> out into their own argument</p></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>The</strong> <code>*</code> <strong>Character in function arguments can cause confusion with C and C++ syntax</strong></p>
<p>As discussed in python <code>*</code> is used to represent unpacking a collection into it’s constituent values. Other languages may use <code>*</code> for different meanings. An example is C and C++ where <code>*</code> is used to handle and manipulate pointers (memory addresses). Something to learn as you work with multiple languages - be careful not to get your syntax’s confused.</p>
</div>
</div>
<ul>
<li>Python provides an inbuilt function that performs the functionality of the <code>add_function</code> called <code>sum</code>
<ul>
<li><code>sum</code> expects its arguments to passed as an iterable though</li>
</ul>
<div id="9bbcfc4f" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>  <span class="bu">sum</span>(numbers)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>10</code></pre>
</div>
</div></li>
<li>Some sample code for arbitrary argument functions is provided in <a href="./Examples/06_ArbitraryArgumentFunctions/ArbitraryArgumentFunctions.py">ArbitaryArgumentFunctions.py</a></li>
</ul>
</section>
</section>
</section>
<section id="modules-and-packages" class="level3">
<h3 class="anchored" data-anchor-id="modules-and-packages">Modules and Packages</h3>
<p>We’ve already seen that we can build python programs out of multiple source files. In this section we’ll look more closely at ways of structuring large python projects split across multiple files through the concepts of modules and packages</p>
<section id="python-modules" class="level4">
<h4 class="anchored" data-anchor-id="python-modules">Python Modules</h4>
<ul>
<li><p>A python module is essentially a python file</p></li>
<li><p>For example the file <code>BTCInput.py</code> is a file that contains function definitions for reading valid input</p>
<ul>
<li>We also call it a module</li>
</ul></li>
<li><p>Typically the difference between a <em>module</em> and a <em>script</em> is that a module is designed to be imported by another program</p>
<ul>
<li>A script typically runs standalone</li>
<li>This is just a heuristic though</li>
</ul></li>
<li><p>We’ve seen that we can include a module using the <code>import</code> statement</p></li>
<li><p>So if we wanted to use <code>BTCInput</code> to read an integer restricted to a range, we write</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> BTCInput</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  age <span class="op">=</span> BTCInput.read_int_ranged(prompt<span class="op">=</span><span class="st">"Enter age: "</span>, min_value<span class="op">=</span><span class="dv">5</span>, max_value<span class="op">=</span><span class="dv">95</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Your age is: "</span>, age)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>A sample interaction might then be,</p>
<div id="fb427d8a" class="cell" data-execution_count="35">
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Enter age: <span class="ansi-red-fg"> 31</span>

Your age is: 31
</pre>
</div>
</div>
</div></li>
<li><p>Python will execute and obey all statements in a module when a module is imported</p></li>
<li><p>For <code>BTCInput</code> these are function definitions</p></li>
<li><p>A module could also define variables or other code that should be executed on load-</p></li>
</ul>
<section id="add-a-readme-function-to-btcinput" class="level5">
<h5 class="anchored" data-anchor-id="add-a-readme-function-to-btcinput">Add a <code>readme</code> Function to BTCInput</h5>
<ul>
<li><p>We could add a <code>readme</code> function to <code>BTCInput</code> that describes the modules contents</p>
<div id="816504a4" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>  VERSION <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> readme():</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"""Welcome to the BTCInput functions module version </span><span class="sc">{0}</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="st">  BTCInput provides functions for reading numbers and strings and validating the</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="st">  user input.</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="st">  The functions are used as follows:</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="st">  text = read_text(prompt)</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="st">  int_value = read_int(prompt)</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="st">  int_float = read_float(prompt)</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="st">  int_value = read_int_ranged(prompt, min_value, max_value)</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="st">  float_value = read_float_ranged(prompt, min_value, max_value)</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="st">  BTCInput also provides read_number and read_number_ranged which can be</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="st">  used in conjunction with a user-defined function to provide custom</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="st">  number parsing behaviour</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="st">  Have fun with them.</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="st">  Rob Miles"""</span>.<span class="bu">format</span>(VERSION)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li><p><code>readme</code> displays a string which provides the user with some basic usage information</p></li>
<li><p>We’ve added a little variable that tracks the version of the file - automatically updated in the documentation</p></li>
<li><p>The user has to manually call the <code>readme</code> though</p></li>
<li><p>Later we’ll see how to generate the description text directly from the code docstring (<a href="#view-program-documentation">View Program Documentation</a>)</p></li>
</ul>
</section>
<section id="run-a-module-as-a-program" class="level5">
<h5 class="anchored" data-anchor-id="run-a-module-as-a-program">Run a Module as a Program</h5>
<ul>
<li>Python modules are files like any other</li>
<li>They can be run by the python interpreter</li>
<li>For example, we might add a call to <code>readme</code>
<ul>
<li>So someone running <code>BTCInput</code> automatically sees the documentation</li>
</ul>
<div id="1ca82f31" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># all the BTCInput functions go here</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># end of the file</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  readme()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Welcome to the BTCInput functions module version 1.0.0

BTCInput provides functions for reading numbers and strings and validating the
user input.

The functions are used as follows:
text = read_text(prompt)
int_value = read_int(prompt)
int_float = read_float(prompt)
int_value = read_int_ranged(prompt, min_value, max_value)
float_value = read_float_ranged(prompt, min_value, max_value)

BTCInput also provides read_number and read_number_ranged which can be
used in conjunction with a user-defined function to provide custom
number parsing behaviour

Have fun with them.
Rob Miles</code></pre>
</div>
</div></li>
<li>Recall: on importing python executes all the statements in a file</li>
<li>This means the readme is displayed even when the user imports the module
<ul>
<li>Probably not the desired behaviour</li>
</ul></li>
</ul>
</section>
<section id="detect-when-a-module-is-executed-as-a-program" class="level5">
<h5 class="anchored" data-anchor-id="detect-when-a-module-is-executed-as-a-program">Detect when a Module is Executed as a Program</h5>
<ul>
<li><p>Printing the <code>readme</code> is useful when the actual module is executed</p></li>
<li><p>However, would like a way to turn this off when the module is imported</p></li>
<li><p>Python provides the <code>__name__</code> variable</p>
<ul>
<li>Helps define the context in which the program is running</li>
</ul></li>
<li><p>If a module is imported, <code>__name__</code> is set to the name of the module</p></li>
<li><p>If a module is running as the original code that started the program, then <code>__name__</code> is set to <code>__main__</code></p></li>
<li><p>Can thus be used to restrict code that we don’t want to run outside of the <code>__main__</code> context (or alternatively on import)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>      readme()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<section id="make-something-happen-checking-program-context" class="level6">
<h6 class="anchored" data-anchor-id="make-something-happen-checking-program-context">Make Something Happen: Checking Program Context</h6>
<p><em>Click here to access the updated version of</em> <a href="./Examples/07_BTCInputWithReadme/BTCInput.py"><code>BTCInput</code></a></p>
<p><em>Run the file through the interpreter, you should see the <code>readme</code> be displayed. Then replace the implementation of</em> <code>BTCInput</code> <em>in one of the previous examples with this new implementation and run that program. You should see that the the readme will not be displayed even though the file is imported</em></p>
<ul>
<li>Often useful to write modules also provide functionality as a program</li>
<li>For example, you may provide documentation as above, demonstrate examples alternatively a module may be designed to perform some basic functionality on user input (e.g.&nbsp;a mathematical program might read numbers and perform a calculation) and be imported by more complex programs</li>
</ul>
</section>
</section>
</section>
<section id="create-a-python-package" class="level4">
<h4 class="anchored" data-anchor-id="create-a-python-package">Create a Python Package</h4>
<ul>
<li>Large programs may contain many different program files</li>
<li>At that point we might want to start thinking about how we organise files, rather than have everything in one folder</li>
<li>This is the point at which packages can help</li>
<li>A common organisation pattern (that we’ve previously utilised) is to put every major component in it’s own file</li>
<li>For example in our <a href="../../02_AdvancedProgramming/11_ObjectBasedSolutionDesign/Chapter_11.html#fashion-shop-application">Fashion Shop</a> we created two types of classes
<ol type="1">
<li>Those that handled the data (<code>StockItem</code>, <code>FashionShop</code>)</li>
<li>Those that handled the UI (<code>FashionShopApplication</code>)</li>
</ol></li>
<li>Each of these components was written as it’s own file, and we wrapped the entry point in our <code>FashionShopApplication.py</code>
<ul>
<li><code>FashionShopApplication.py</code> imported <code>StockItem.py</code> and <code>FashionShop.py</code> to get the associated class components</li>
</ul></li>
<li>An alternative arrangement might be to formulate the <em>data</em> components as one <em>package</em> and the <em>UI</em> components as another</li>
<li>A (local) python package is a directory containing a set of python source files
<ul>
<li>An <code>__init__.py</code> file is used to mark a package</li>
</ul></li>
<li>Below show’s how we could restructure the fashion shop application to use a package structure</li>
</ul>
<pre class="{shell}"><code>.
├── Data
│   ├── FashionShop.py
│   ├── StockItem.py
│   └── __init__.py
├── FashionShopShellUI.py
└── UI
    ├── BTCInput.py
    ├── FashionShopApplication.py
    └── __init__.py</code></pre>
<ol type="1">
<li><p><code>UI</code> contains the classes responsible for handling the user</p>
<ul>
<li><p>Currently these are all shell-based</p></li>
<li><p>If in the future we introduce a GUI option we might create subpackages for UI</p>
<ol type="1">
<li><code>ShellUI</code> for shell-based interactivity</li>
<li><code>GUI</code> for graphical-based interactivity</li>
</ol></li>
<li><p>Also contains an <code>__init__.py</code> file</p></li>
</ul></li>
<li><p><code>Data</code> contains the classes responsible for handling the fashion shop data</p>
<ul>
<li>This is the <code>StockItem</code> class, and the <code>FashionShop</code> container class</li>
<li>Again, we need the <code>__init__.py</code></li>
</ul></li>
<li><p>Outside the class structure we define a <code>FashionShopShellUI.py</code> which is the entry point file</p>
<ul>
<li>Consumes the classes in the subpackages</li>
<li>This is not a package itself, so no need for an <code>__init__.py</code></li>
</ul></li>
</ol>
<section id="code-analysis-making-modules" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-making-modules">Code Analysis: Making Modules</h5>
<p><em>Consider the following questions about modules</em></p>
<ol type="1">
<li><p><em>How do I decide which module goes in which package?</em></p>
<ul>
<li><p>Related classes and functions should be in the same package</p></li>
<li><p>For the fashion shop as we’ve identified the types of modules are</p>
<ol type="1">
<li>Those that handle the user interaction (<code>FashionShopApplication.py</code> and <code>BTCInput.py</code>)</li>
<li>Those that handle the data representation of the fashion shop (<code>FashionShop</code> and <code>StockItem</code>)</li>
</ol></li>
</ul></li>
<li><p><em>What does the</em> <code>__init__.py</code> <em>file in a package do?</em></p>
<ul>
<li><code>__init__.py</code> controls how a package is loaded</li>
<li><code>__init__.py</code> is ran when a package is first opened
<ul>
<li>Like the constructor for a package</li>
<li>Can set up resources, e.g.&nbsp;a help string, global constants etc.</li>
</ul></li>
</ul></li>
</ol>
</section>
</section>
<section id="import-modules-from-packages" class="level4">
<h4 class="anchored" data-anchor-id="import-modules-from-packages">Import Modules from Packages</h4>
<ul>
<li><p>Modules can be imported from packages</p>
<ul>
<li>Syntax is like that for importing a single class, function or variable from a module</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> Data <span class="im">import</span> FashionShop</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Contents of the <code>FashionShop</code> module now available</p></li>
<li><p>Can be used as we’ve seen before</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>  shop <span class="op">=</span> FashionShop.FashionShop()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>As we’ve talked before the <code>FashionShop</code> class is namespaced by the module <code>FashionShop.py</code> (minus the .py extension)</p></li>
<li><p>If there was another <code>FashionShop</code> defined in another package (say <code>DataStorage.py</code>) we can differentiate them, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>  shop2 <span class="op">=</span> DataStorage.FashionShop()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>We could also just import the higher level package (<code>Data</code>) like a module, i.e.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> Data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Contents of the <code>Data</code> package now available</p>
<ul>
<li><p>Adds another level of namespacing, e.g.&nbsp;setting accessing the <code>FashionShop</code> class is now</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>  shop <span class="op">=</span> Data.FashionShop.FashionShop()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul></li>
</ul>
<section id="make-something-happen-use-classes-as-values" class="level5">
<h5 class="anchored" data-anchor-id="make-something-happen-use-classes-as-values">Make Something Happen: Use Classes as Values</h5>
<p><em>Classes can be used as values just as we’ve seen with functions. Work through the following steps in the python interpreter to understand how this works</em></p>
<ol type="1">
<li><p><em>Enter the statements below into the python interpreter</em></p>
<div id="5828b2d2" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">class</span> VarTest:</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="st">"making a VarTest"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>This creates a class <code>VarTest</code> with a constructor</p></li>
<li><p>Constructor simply prints a message</p></li>
<li><p>We can create a <code>VarTest</code> instance easily enough</p>
<div id="09f94762" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> VarTest()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>making a VarTest</code></pre>
</div>
</div></li>
<li><p>We can see the <code>__init__</code> method is called and we create a new <code>VarTest</code> instance, referenced by <code>x</code></p></li>
</ul></li>
<li><p><em>Now assign the class definition itself to a variable, as in the statement below</em></p>
<div id="8594933a" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a> y <span class="op">=</span> VarTest</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>Observe no parentheses around <code>VarTest</code></p></li>
<li><p>Mirrors the case where we want a reference to a function</p></li>
<li><p><code>y</code> has the value of <code>VarTest</code> which is the class definition itself</p></li>
<li><p><code>y</code> is effectively an alias for <code>VarTest</code> and can be used the same way, e.g.</p>
<div id="a838e0fa" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>  z <span class="op">=</span> y()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>making a VarTest</code></pre>
</div>
</div></li>
<li><p>We can see that this creates a new <code>VarTest</code> instance and assigns it to <code>z</code></p>
<ul>
<li>As if we had written <code>z = Vartest()</code> directly</li>
</ul></li>
</ul></li>
</ol>
<ul>
<li><p>Class references can be treated as any other data, including</p>
<ol type="1">
<li>Being used in collections (e.g.&nbsp;lists, dictionaries)</li>
<li>Passed as arguments to function calls</li>
</ol></li>
<li><p>The statement below sets the variable <code>shop</code> to the class definition of the <code>FashionShop</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>  shop <span class="op">=</span> FashionShop.FashionShop</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Our UI shouldn’t need to know about the underlying data representation directly</p>
<ul>
<li>Should just now the interface it needs to work with</li>
<li>Then we can have it accept any implementation that obeys this interface</li>
<li>We could say then pass <code>shop</code> as an argument</li>
</ul></li>
</ul>
</section>
<section id="code-analysis-references-to-classes" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-references-to-classes">Code Analysis: References to Classes</h5>
<p><em>Work through the following questions to understand how class references work</em></p>
<ol type="1">
<li><p><em>What are the benefits of using class references?</em></p>
<ul>
<li>Class references allow to define common implementations and then change the underlying implementation
<ul>
<li>We might replace the shell interface with a GUI</li>
<li>We might replace the FashionShop in-memory data storage with a database</li>
</ul></li>
<li>If we can make the new implementations conform to the interface then all we need to do is change the class reference
<ul>
<li>Reduces the coupling between components</li>
<li>Makes the implementation easier to manage</li>
</ul></li>
</ul></li>
</ol>
<ul>
<li><p>How do we introduce class references in a program?</p></li>
<li><p>We’ll write a program <code>FashionShopShellUI.py</code> that handles connecting the components together</p>
<ul>
<li>Creates the UI and displays it</li>
<li>Start by importing our modules</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Example 12.8a Modular Fashion Shop</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Provides the entry point and coordinating behaviour for a modularised</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implementation of the Fashion Shop Application</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> Data <span class="im">import</span> FashionShop</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> UI <span class="im">import</span> FashionShopApplication</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load the UI implementation</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  ui <span class="op">=</span> FashionShopApplication.FashionShopApplication</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load the data management implementation</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  shop <span class="op">=</span> FashionShop.FashionShop</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  app <span class="op">=</span> ui(filename<span class="op">=</span><span class="st">"fashionshop.pickle"</span>, storage_class<span class="op">=</span>shop)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>We start by defining on <code>ui</code> and <code>shop</code> classes which take the UI implementation in <code>FashionShopApplication</code> and <code>FashionShop</code> respectively</p></li>
<li><p>We then have to create our application</p>
<ul>
<li>We create an instance of the application (using the reference <code>ui</code>)
<ul>
<li>We pass <code>shop</code> to define how the data is managed</li>
<li>Observe that this is a new change to the API of <code>FashionShopApplication</code> we’ll have to implement</li>
</ul></li>
</ul></li>
<li><p>Let’s update the <code>FashionShopApplication</code> API</p>
<ul>
<li>We want to accept a class reference now when we construct the object</li>
<li>So we have to add one to the <code>__init__</code> method</li>
<li>We then want to replace explicit calls to <code>FashionShop</code> with calls to this class reference</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> FashionShopApplication:</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">"""</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co">      Provides a text-based interface for Fashion Shop inventory management</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">      """</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filename, storage_class):</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>          <span class="co">"""</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">          Creates a new `FashionShopApplication`</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co">          Attempts to load a `FashionShop` from the provided file. Otherwise</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co">          an empty instance is created</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co">          Parameters</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="co">          ----------</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co">          filename : str</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co">              path to a file containing pickled `FashionShop` data</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="co">          storage_class : Data Manager</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co">              class that supports the Fashion Shop Data Management API</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co">          See Also</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co">          --------</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co">          FashionShop : Main class for handling inventory management</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a><span class="co">          """</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>          FashionShopApplication.__filename <span class="op">=</span> filename</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>          <span class="cf">try</span>:</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>              <span class="va">self</span>.__shop <span class="op">=</span> storage_class.load(filename)</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>          <span class="cf">except</span>:  <span class="co"># noqa: E722</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="st">"Failed to load Fashion Shop"</span>)</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="st">"Creating an empty Fashion Shop"</span>)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>              <span class="va">self</span>.__shop <span class="op">=</span> storage_class()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>We’ve changed the API on the <code>__init__</code> so we have to make sure we update the docstring appropriately</li>
</ul></li>
<li><p>Now we want to start running the program as before</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>  app.main_menu()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>There is one small step as well which is to update the import statements in <code>FashionShopApplication.py</code></p>
<ul>
<li><p>No longer explicitly requires <code>FashionShop</code></p></li>
<li><p>Needs to import <code>StockItem</code> from the <code>Data</code> package</p></li>
<li><p>Needs to import <code>BTCInput</code> from the <code>UI</code> package</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>  - import BTCInput</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  + from UI import BTCInput</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  - import StockItem</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  + from Data import StockItem</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  - import FashionShop</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Python imports can be Confusing</strong></p>
<p>An annoying feature of python import statements is that they are resolved relative to the directory where the entry point is. This means that even though <code>BTCInput</code> is in the same package as <code>FashionShopApplication</code> we can’t write</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> BTCInput</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>but instead have to write</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> UI <span class="im">import</span> BTCInput</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This is rather annoying because in theory <code>FashionShopApplication</code> shouldn’t need to care what folder it’s located in, let alone where the starting point is. If we wanted to write another higher level program that contained our entire fashion shop application as a package this would break the imports. The way to resolve this is to <em>install</em> the packages, but that’s beyond the scope for now</p>
</div>
</div>
<ul>
<li>You can find the modularised implementation in <a href="./Examples/08_FashionShopApp">08_FashionShopApp</a></li>
<li>As an aside in the future as we add implementations we would likely rename <code>FashionShopApplication</code> to something more descriptive like <code>FashionShopShell</code></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Using classes as values is an extremely powerful programming technique</strong></p>
<p>The technique of passing functions or classes as arguments to higher-level classes or functions is called <em>dependency injection</em>. The idea is that if a class or function uses the interface of another class or function rather than hardcoding what the implementation of that interface is, we allow the implementation to be passed in as an argument (i.e.&nbsp;we inject the behaviour we want to implement)</p>
<p>The idea is to let us change how the behaviours specified by an API are implemented, for example we can use this to switch between a basic shell ui, a terminal-based ui or a full graphical ui. We might also want to switch our data storage layer from an in-memory approach to one that uses a database. If we hardcode the higher level implementation (i.e.&nbsp;a class that uses an in-memory loader and a shell ui) then we have to create many new implementations to support the desired behaviour. For example if we implement all the above options as hard coded classes we would have,</p>
<ol type="1">
<li>in-memory loader + shell UI</li>
<li>in-memory loader + terminal UI</li>
<li>in-memory loader + graphical UI</li>
<li>database loader + shell UI</li>
<li>database loader + terminal UI</li>
<li>database loader + graphical UI</li>
</ol>
</div>
</div>
<p>In other words, we created three new classes (2 new UI classes and one data storage class) but then had to define <em>five</em> additional classes to handle creating our application. With dependency injection there is no need to define new classes, we just swap out what class references we are using and pass them through to the high level application constructor.</p>
<p>This design also makes it much easier to test large components because we can inject a test implementation.</p>
</section>
</section>
</section>
<section id="program-testing" class="level3">
<h3 class="anchored" data-anchor-id="program-testing">Program Testing</h3>
<ul>
<li><p>Testing is part of the process of validating that a program meets requirements</p></li>
<li><p>Tests should be</p>
<ul>
<li>Repeatable (we can conduct the same test multiple times)</li>
<li>Documented (they clearly indicate what they test and the results)</li>
<li>Automatic (tests should be an integrated part of development)</li>
</ul></li>
<li><p>Let’s consider implementing tests for the <code>StockItem</code> from the <a href="../../02_AdvancedProgramming/11_ObjectBasedSolutionDesign/Chapter_11.html#fashion-shop-application">Fashion Shop Application</a></p></li>
<li><p>We need to start by defining what features we want to test</p>
<ul>
<li>Validate that newly constructed <code>StockItem</code> instances have correctly set values for their attributes</li>
<li>Attempts to create an invalid <code>StockItem</code> are rejected</li>
<li><code>StockItem</code> methods behave as expected</li>
</ul></li>
<li><p>We could start with manual testing</p>
<ul>
<li>i.e.&nbsp;create a <code>StockItem</code> using the interpreter and check the behaviours</li>
</ul></li>
<li><p>However this is clearly not automatic</p></li>
<li><p>It is difficult to repeat since we have to follow the steps clearly</p></li>
<li><p>Hard to document</p>
<ul>
<li>Ideally the documentation should be colocated with the test</li>
<li>The same way we colocate documentation with a function (docstrings)</li>
<li>Clearly not the case if we’re manually entering values</li>
</ul></li>
<li><p>Better is to write code that automatically tests the class</p>
<ul>
<li>We’ve seen similar before where we’ve written <code>print</code> statements that output an expected versus actual value</li>
<li>See <a href="#exercise-write-a-roman-numeral-converter">Roman Numeral Converter</a> for an example</li>
<li>This still has the downside that we need to manually parse the output to check the tests passed</li>
<li>Would be good to automate this part of the process as well!</li>
</ul></li>
<li><p>An improvement might be to use exceptions, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>  item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tag<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> item.stock_level <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Initial Stock level not 0"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>This means that any failed test will stop the program and alert the user</p></li>
<li><p>How could we test code that <em>is</em> supposed to throw an exception?</p></li>
<li><p>We could write a wrapper, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>  excepted <span class="op">=</span> <span class="va">False</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>      <span class="co">"""</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">      Test behaviour that</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">      should raise an exception</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">      goes here</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co">      """</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>: <span class="co"># ideally specify the exact exception we expect</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>      excepted <span class="op">=</span> <span class="va">True</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> excepted:</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Test Failed: No Exception raised"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Ideally define lots of small tests</p></li>
<li><p>Repeat the relevant tests each time part of a program is updated</p></li>
<li><p>On large programs tests might be run automatically every day, night etc.</p></li>
<li><p>Python provides some tools for making testing easier to implement</p></li>
</ul>
<section id="the-python-assert-statement" class="level4">
<h4 class="anchored" data-anchor-id="the-python-assert-statement">The Python <code>assert</code> Statement</h4>
<ul>
<li><p>Python defines the <code>assert</code> keyword</p></li>
<li><p>Let’s programs test as they run</p></li>
<li><p>Assert means “ensure this is true”</p></li>
<li><p>We can rewrite the previous test using <code>assert</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>  item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">assert</span> item.stock_level <span class="op">==</span> <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Let’s see what happens if the assert fails</p>
<ul>
<li>We’ll define a dummy <code>StockItem</code> class with a non-zero starting stock level</li>
</ul>
<div id="cd2c043e" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> StockItem:</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, stock_ref, price, tags):</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.stock_level <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">assert</span> item.stock_level <span class="op">==</span> <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[42]</span><span class="ansi-green-fg">, line 6</span>
<span class="ansi-green-fg">      3</span>         <span style="color:rgb(0,135,0)">self</span>.stock_level = <span class="ansi-green-fg">1</span>
<span class="ansi-green-fg">      5</span> item = StockItem(stock_ref=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Test</span><span class="ansi-yellow-fg">"</span>, price=<span class="ansi-green-fg">10</span>, tags=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">test:tag</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">6</span> <span style="font-weight:bold;color:rgb(0,135,0)">assert</span> item.stock_level == <span class="ansi-green-fg">0</span>

<span class="ansi-red-fg">AssertionError</span>: </pre>
</div>
</div>
</div></li>
<li><p>As we can see an <code>AssertionError</code> is raised</p>
<ul>
<li>Just like any other form of exception</li>
</ul></li>
</ul>
<section id="code-analysis-python-assertions" class="level5">
<h5 class="anchored" data-anchor-id="code-analysis-python-assertions">Code Analysis: Python Assertions</h5>
<p><em>Work through the following questions about</em> <code>assert</code> <em>statements</em></p>
<ol type="1">
<li><p><em>How many</em> <code>assert</code> <em>statements can a program contain?</em></p>
<ul>
<li>There is no limit</li>
</ul></li>
<li><p><em>Does the program continue after an assertion has failed?</em></p>
<ul>
<li>Depends on how the program handles it</li>
<li>If there’s no exception handling then the program will be stopped</li>
<li>A <code>try...catch</code> block may allow the program to recover</li>
</ul></li>
</ol>
</section>
</section>
<section id="the-python-unittest-module" class="level4">
<h4 class="anchored" data-anchor-id="the-python-unittest-module">The Python <code>unittest</code> Module</h4>
<ul>
<li><code>assert</code> lets us write checks that execute in code
<ul>
<li>Can be used to halt a program if an invalid state in encountered during execution</li>
<li>Doesn’t intrinsically help us write many, small, independent tests</li>
</ul></li>
<li>Python provides a framework for automating the construction and execution of <em>unit tests</em></li>
<li>Unit tests are small, self-contained test designed to verify <em>one</em> behaviour (a unit)</li>
<li>Unit tests for a component should be created alongside the component itself
<ul>
<li>In <em>test-driven development</em> the tests are written before the components themselves
<ul>
<li>Or at least <em>defined</em> until we stabilise the API</li>
<li>Code is written such that by implementing the behaviour to pass every more sophisticated tests we create a working component</li>
</ul></li>
</ul></li>
<li><code>unittest</code> is provided as part of the python standard installation
<ul>
<li><p>Imported the usual way</p>
<div id="5391cb6d" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> unittest</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
</ul></li>
<li>Recall our complete (tag-based) <code>StockItem</code> implementation</li>
</ul>
<div id="7fc06ef7" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StockItem:</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Represents a single inventory item</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co">    stock_ref : str</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co">        reference id of the stock item</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co">    tags : set[str]</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co">        set of tags describing the stock item</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Class Attributes</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------------</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co">    show_instrumentation : bool</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Indicates if instrumentation should be printed</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co">    max_stock_add : int</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="co">        maximum amount of stock that can be added to an item's stock level at a time</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="co">    min_price : int | float</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="co">        minimum price of any stock item</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="co">    max_price : int | float</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co">        maximum price of any stock item</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>    show_instrumentation <span class="op">=</span> <span class="va">True</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    max_stock_add <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>    min_price <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>    max_price <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, stock_ref, price, tags):</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="co">        Creates a `StockItem` instance</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="co">        stock_ref : str</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="co">            stock reference id</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="co">        price : int | float</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="co">            stock price</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a><span class="co">        tags : set[str]</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a><span class="co">            set of tags describing the stock item</span></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem __init__ called"</span>)</span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stock_ref <span class="op">=</span> stock_ref</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.__price <span class="op">=</span> price</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tags <span class="op">=</span> tags</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.__stock_level <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.__StockItem_version <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem __str__ called"</span>)</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>        template <span class="op">=</span> <span class="st">"""Stock Reference: </span><span class="sc">{0}</span></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a><span class="st">Price: </span><span class="sc">{1}</span></span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a><span class="st">Stock level: </span><span class="sc">{2}</span></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="st">Tags: </span><span class="sc">{3}</span><span class="st">"""</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> template.<span class="bu">format</span>(<span class="va">self</span>.stock_ref, <span class="va">self</span>.price, <span class="va">self</span>.stock_level, <span class="va">self</span>.tags)</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> price(<span class="va">self</span>):</span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a><span class="co">        price : int | float</span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a><span class="co">            dress price</span></span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem get price called"</span>)</span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.__price</span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> stock_level(<span class="va">self</span>):</span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a><span class="co">        stock_level : int</span></span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a><span class="co">            amount of stock in inventory</span></span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem get stock_level called"</span>)</span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.__stock_level</span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_version(<span class="va">self</span>):</span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a><span class="co">        Checks the version of a `StockItem` instance and upgrades it if required</span></span>
<span id="cb94-84"><a href="#cb94-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-85"><a href="#cb94-85" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb94-86"><a href="#cb94-86" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb94-87"><a href="#cb94-87" aria-hidden="true" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb94-88"><a href="#cb94-88" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-89"><a href="#cb94-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-90"><a href="#cb94-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem check_version called"</span>)</span>
<span id="cb94-91"><a href="#cb94-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.__StockItem_version <span class="op">!=</span> <span class="dv">4</span>:</span>
<span id="cb94-92"><a href="#cb94-92" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Stock item uses old data model, please recreate this item"</span>)</span>
<span id="cb94-93"><a href="#cb94-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-94"><a href="#cb94-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_stock(<span class="va">self</span>, count):</span>
<span id="cb94-95"><a href="#cb94-95" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-96"><a href="#cb94-96" aria-hidden="true" tabindex="-1"></a><span class="co">        Add stock to an item</span></span>
<span id="cb94-97"><a href="#cb94-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-98"><a href="#cb94-98" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb94-99"><a href="#cb94-99" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb94-100"><a href="#cb94-100" aria-hidden="true" tabindex="-1"></a><span class="co">        count : int</span></span>
<span id="cb94-101"><a href="#cb94-101" aria-hidden="true" tabindex="-1"></a><span class="co">            amount of stock to add to an item</span></span>
<span id="cb94-102"><a href="#cb94-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-103"><a href="#cb94-103" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb94-104"><a href="#cb94-104" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb94-105"><a href="#cb94-105" aria-hidden="true" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb94-106"><a href="#cb94-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-107"><a href="#cb94-107" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb94-108"><a href="#cb94-108" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb94-109"><a href="#cb94-109" aria-hidden="true" tabindex="-1"></a><span class="co">        Exception</span></span>
<span id="cb94-110"><a href="#cb94-110" aria-hidden="true" tabindex="-1"></a><span class="co">            raised if `count` &lt; 0 or `count` &gt; `StockItem.max_stock_add`</span></span>
<span id="cb94-111"><a href="#cb94-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-112"><a href="#cb94-112" aria-hidden="true" tabindex="-1"></a><span class="co">        See Also</span></span>
<span id="cb94-113"><a href="#cb94-113" aria-hidden="true" tabindex="-1"></a><span class="co">        --------</span></span>
<span id="cb94-114"><a href="#cb94-114" aria-hidden="true" tabindex="-1"></a><span class="co">        StockItem.max_stock_add : maximum amount of stock that can be added to a `StockItem`</span></span>
<span id="cb94-115"><a href="#cb94-115" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-116"><a href="#cb94-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-117"><a href="#cb94-117" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem add_stock called"</span>)</span>
<span id="cb94-118"><a href="#cb94-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> count <span class="op">&gt;</span> StockItem.max_stock_add:</span>
<span id="cb94-119"><a href="#cb94-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Invalid add amount"</span>)</span>
<span id="cb94-120"><a href="#cb94-120" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.__stock_level <span class="op">=</span> <span class="va">self</span>.__stock_level <span class="op">+</span> count</span>
<span id="cb94-121"><a href="#cb94-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-122"><a href="#cb94-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sell_stock(<span class="va">self</span>, count):</span>
<span id="cb94-123"><a href="#cb94-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb94-124"><a href="#cb94-124" aria-hidden="true" tabindex="-1"></a><span class="co">        Sell stock of an item</span></span>
<span id="cb94-125"><a href="#cb94-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-126"><a href="#cb94-126" aria-hidden="true" tabindex="-1"></a><span class="co">        Decreases the item's stock level</span></span>
<span id="cb94-127"><a href="#cb94-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-128"><a href="#cb94-128" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb94-129"><a href="#cb94-129" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb94-130"><a href="#cb94-130" aria-hidden="true" tabindex="-1"></a><span class="co">        count : int</span></span>
<span id="cb94-131"><a href="#cb94-131" aria-hidden="true" tabindex="-1"></a><span class="co">            amount of stock to sell</span></span>
<span id="cb94-132"><a href="#cb94-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-133"><a href="#cb94-133" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb94-134"><a href="#cb94-134" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb94-135"><a href="#cb94-135" aria-hidden="true" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb94-136"><a href="#cb94-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-137"><a href="#cb94-137" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb94-138"><a href="#cb94-138" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb94-139"><a href="#cb94-139" aria-hidden="true" tabindex="-1"></a><span class="co">        Exception</span></span>
<span id="cb94-140"><a href="#cb94-140" aria-hidden="true" tabindex="-1"></a><span class="co">            raised if `count` &lt; 1 or `count` is greater than the available stock</span></span>
<span id="cb94-141"><a href="#cb94-141" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb94-142"><a href="#cb94-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> StockItem.show_instrumentation:</span>
<span id="cb94-143"><a href="#cb94-143" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"**StockItem sell_stock called"</span>)</span>
<span id="cb94-144"><a href="#cb94-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb94-145"><a href="#cb94-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Invalid number of items to sell"</span>)</span>
<span id="cb94-146"><a href="#cb94-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="va">self</span>.__stock_level:</span>
<span id="cb94-147"><a href="#cb94-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Not enough stock to sell"</span>)</span>
<span id="cb94-148"><a href="#cb94-148" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.__stock_level <span class="op">=</span> <span class="va">self</span>.__stock_level <span class="op">-</span> count</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><p>Let’s use <code>unittest</code> to write some unit tests</p></li>
<li><p><code>unittest</code> provides a class (<code>TestCase</code>) that acts as a superclass for tests</p></li>
<li><p>We create our tests by subclassing <code>TestCase</code></p>
<ul>
<li>We populate the class with method which implement our tests</li>
</ul></li>
<li><p>First we’ll write a test for the initializer</p>
<div id="ea25d27a" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> TestStockItem(unittest.TestCase):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_StockItem_init(<span class="va">self</span>):</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>          item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.stock_ref, <span class="st">"Test"</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.price, <span class="dv">10</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">0</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.tags, <span class="st">"test:tag"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li><p><code>TestStockItem</code> is our test class</p>
<ul>
<li>The method <code>test_StockItem_init</code> tests the <code>__init__</code> correctly sets the values on a <code>StockItem</code> instance</li>
</ul></li>
<li><p><code>self.assertEqual</code> is a method inherited from the <code>TestCase</code> superclass</p>
<ul>
<li>Performs the test</li>
<li>Functions like an <code>assert</code> in that it checks that the value passed as the first argument matches the value in the second argument
<ul>
<li>If equal the test passes</li>
<li>Else, test fails</li>
</ul></li>
</ul></li>
<li><p>We can run the test by calling the <code>main</code> method for the <code>unittest</code> module</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>  unittest.main()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<div id="0e8dbfd3" class="cell" data-execution_count="46">
<div class="cell-output cell-output-stderr">
<pre><code>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**StockItem __init__ called
**StockItem get price called
**StockItem get stock_level called</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc20ce90&gt;</code></pre>
</div>
</div>
<ul>
<li>The above should show that our test executed successfully</li>
<li>If we want more detail we can use the <code>verbosity</code> parameter
<ul>
<li>Integer number which represents the level of output detail</li>
</ul></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>    unittest.main(verbosity<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="b8032702" class="cell" data-execution_count="47">
<div class="cell-output cell-output-stderr">
<pre><code>test_StockItem_init (__main__.TestStockItem.test_StockItem_init) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.001s

OK</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**StockItem __init__ called
**StockItem get price called
**StockItem get stock_level called</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc20c500&gt;</code></pre>
</div>
</div>
<ul>
<li>We can now see the name and status of each individual test</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Attempting to run</strong> <code>unittest</code> <strong>in an IPython Notebook may cause issues</strong></p>
<p>For IPython Notebooks such as the ones I have used to type up these notes, calling <code>unittest.main()</code> as written above fails to work due to intricacies with how the IPython works. The correct usage in that case is,</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>unittest.main(argv<span class="op">=</span>[<span class="st">'first-arg-is-ignored'</span>], exit<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>See <a href="https://stackoverflow.com/questions/37895781/unable-to-run-unittests-main-function-in-ipython-jupyter-notebook">Stack Overflow</a> for an explanation</p>
</div>
</div>
<ul>
<li><p>What happens if a test fails?</p>
<div id="8a2bee7b" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> TestAlwaysFails(unittest.TestCase):</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_that_fails(<span class="va">self</span>):</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(<span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li><p>The above defines a test that trivially fails, if we run our unit tests then</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>  unittest.main()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul>
<div id="0747364d" class="cell" data-execution_count="49">
<div class="cell-output cell-output-stderr">
<pre><code>F</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**StockItem __init__ called
**StockItem get price called
**StockItem get stock_level called</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>.
======================================================================
FAIL: test_that_fails (__main__.TestAlwaysFails.test_that_fails)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/tmp/ipykernel_3342/3483629732.py", line 4, in test_that_fails
    self.assertEqual(1, 0)
AssertionError: 1 != 0

----------------------------------------------------------------------
Ran 2 tests in 0.001s

FAILED (failures=1)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc207d70&gt;</code></pre>
</div>
</div>
<ul>
<li><p>The output indicates that tests have failed</p></li>
<li><p>Also specifies the specific failed test</p></li>
<li><p>There are a range of possible assertion conditions for statements</p>
<ul>
<li>See the table below</li>
</ul></li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 33%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Test Function</th>
<th>Test Action</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>assertEqual(a,b)</code></td>
<td>Asserts that <code>a</code> is the same as <code>b</code></td>
<td>Test that two values are the same</td>
</tr>
<tr class="even">
<td><code>assertNotEqual(a, b)</code></td>
<td>Asserts that <code>a</code> is not the same as <code>b</code></td>
<td>Test that two values differ</td>
</tr>
<tr class="odd">
<td><code>assertTrue(a)</code></td>
<td>Asserts that <code>a</code> is <code>True</code></td>
<td>Test a boolean expression is true</td>
</tr>
<tr class="even">
<td><code>assertFalse(b)</code></td>
<td>Asserts that <code>b</code> is <code>False</code></td>
<td>Test a boolean expression is false</td>
</tr>
<tr class="odd">
<td><code>assertIs(a, b)</code></td>
<td>Assert that <code>a</code> and <code>b</code> refer to the <em>same object</em></td>
<td>Test if two references (variables) refer to the same underlying memory object</td>
</tr>
<tr class="even">
<td><code>assertIsNot(a, b)</code></td>
<td>Assert that <code>a</code> and <code>b</code> refer to <em>different objects</em></td>
<td>Test two references refer to different memory objects</td>
</tr>
<tr class="odd">
<td><code>assertIsNone(a)</code></td>
<td>Assert that <code>r</code> is <code>None</code></td>
<td>Test a variable is explicitly the <code>None</code> value</td>
</tr>
<tr class="even">
<td><code>assertIsNotNone(a)</code></td>
<td>Assert that <code>a</code> is <em>not</em> <code>None</code></td>
<td>Test a variable is explicitly <em>not</em> the <code>None</code> value</td>
</tr>
<tr class="odd">
<td><code>assertIn(a, b)</code></td>
<td>Assert that <code>a</code> is in the collection <code>b</code></td>
<td>Test a value is in a collection</td>
</tr>
<tr class="even">
<td><code>assertNotIn(a, b)</code></td>
<td>Assert that <code>a</code> is <em>not</em> in the collection <code>b</code></td>
<td>Test a value is <em>not</em> in a collection</td>
</tr>
<tr class="odd">
<td><code>assertIsInstance(a, b)</code></td>
<td>Assert that <code>a</code> is an instance of <em>type</em> <code>b</code></td>
<td>Test that a reference refers to an object of a specific type</td>
</tr>
<tr class="even">
<td><code>assertNotIsInstance(a, b)</code></td>
<td>Assert that <code>a</code> is <em>not</em> an instance of <em>type</em> <code>b</code></td>
<td>Test a reference does not refer to a particular object type</td>
</tr>
</tbody>
</table>
<section id="test-for-exceptions" class="level5">
<h5 class="anchored" data-anchor-id="test-for-exceptions">Test for Exceptions</h5>
<ul>
<li>The above table shows how we perform a value-based unit test
<ul>
<li>i.e we execute a statement and check it’s value or type against an expected result</li>
</ul></li>
<li>What is want to perform a behaviour based unit test?
<ul>
<li>e.g.&nbsp;What if we want to test that code correctly throws an exception?</li>
<li>For example the code below attempts to add negative stock
<ul>
<li>Should raise an exception!</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>  item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>,  tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  item.add_stock(<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
</ul></li>
<li>We can use <code>assertRaises</code> to test for exceptions, e.g.</li>
</ul>
<div id="94995841" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unittest</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestStockItem(unittest.TestCase):</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_StockItem_invalid_sell_stock_raises_exception(<span class="va">self</span>):</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>        item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>            item.add_stock(<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Running the unit test (hidden)</li>
</ul>
<div id="4007ea16" class="cell" data-execution_count="53">
<div class="cell-output cell-output-stderr">
<pre><code>.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**StockItem __init__ called
**StockItem add_stock called</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc49bbf0&gt;</code></pre>
</div>
</div>
<ul>
<li>If we wanted to test for specific exceptions we can pass them to <code>assertRaises</code> as arguments</li>
<li>Note that <code>assertRaises</code> works slightly differently to the other tests</li>
<li>We have to wrap the functionality we want to test in the <code>assertRaises</code> context manager using the <code>with</code> keyword
<ul>
<li><code>assertRaises</code> then attempts to catch the exception specified in it’s initializer</li>
</ul></li>
<li>If the exception is not raised the test will fail</li>
</ul>
</section>
</section>
<section id="create-tests" class="level4">
<h4 class="anchored" data-anchor-id="create-tests">Create Tests</h4>
<ul>
<li><code>unittest</code> makes it very easy to add tests to a project</li>
<li>Tests force you to think about <em>how</em> a component should behave</li>
<li>Tests might need you to clarify requirements with a client
<ul>
<li>e.g.&nbsp;We might ask our client to define a maximum amount of stock that could be added
<ul>
<li>Then implement a test to check that behaviour</li>
</ul></li>
</ul></li>
<li>First step is to test that an object is created correctly</li>
<li>After that can test specific behaviours
<ul>
<li>e.g.&nbsp;we want to test that the normal process of adding and selling stock works</li>
</ul>
<div id="fa5ee239" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> TestStockItem(unittest.TestCase):</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_StockItem_add_and_sell_stock(<span class="va">self</span>):</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>          item <span class="op">=</span> StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">0</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>          item.add_stock(<span class="dv">10</span>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">10</span>)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>          item.sell_stock(<span class="dv">2</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></li>
<li>Which should pass when run,</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>    unittest.main(verbosity<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="220c7221" class="cell" data-execution_count="55">
<div class="cell-output cell-output-stderr">
<pre><code>test_StockItem_add_and_sell_stock (__main__.TestStockItem.test_StockItem_add_and_sell_stock) ... ok

----------------------------------------------------------------------
Ran 1 test in 0.001s

OK</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>**StockItem __init__ called
**StockItem get stock_level called
**StockItem add_stock called
**StockItem get stock_level called
**StockItem sell_stock called
**StockItem get stock_level called</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc257260&gt;</code></pre>
</div>
</div>
<ul>
<li><code>unittest</code> can be used to create more complex testing scenarios
<ul>
<li><a href="https://docs.python.org/3/library/unittest.html">Read the docs at the python website</a></li>
</ul></li>
<li>The tests shown above are implemented in <a href="./Examples/09_StockItemWithTests">TestStockItem.py</a></li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Tests only prove the existence of faults</strong></p>
<p>Tests are important and should always be included when making a program. Test’s do not guarantee that a program is correctly implemented, just that it passes the specific tests. It is typically impossible to test all possible paths through a program. Bugs can therefore exist even for extensive testing suites. You should form a habit of reviewing your code to ensure it works, <em>alongside</em> using automated testing to provide an additional layer of protection</p>
</div>
</div>
</section>
<section id="exercise-complete-the-testing-of-stockitem" class="level4">
<h4 class="anchored" data-anchor-id="exercise-complete-the-testing-of-stockitem">Exercise: Complete the Testing of <code>StockItem</code></h4>
<p><em>The provided example tests, check only a limited portion of the</em> <code>StockItem</code> <em>functionality. First remove the automatically failing test, then implement additional tests to check more features of</em> <code>StockItem</code><em>. For example, you should check that an exception is raised if</em> <code>sell_stock</code> <em>is passed a value greater than the current value of</em> <code>stock_level</code></p>
<p>We’ll try and implement a logical sequence of tests, such that each test, tests one functionality, and relies only on functionality that is tested by another test. In general we want to typically only have a single assert in a test, so that we can clearly identify the failure point. Let’s go through method by method</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestStockItem(unittest.TestCase):</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_init(<span class="va">self</span>):</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>        item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(item.stock_ref, <span class="st">"Test"</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(item.price, <span class="dv">10</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">0</span>)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(item.tags, <span class="st">"test:tag"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>We don’t need to modify this <code>__init__</code> check, it checks all the attributes</p>
<ul>
<li>Except the version, but this is a private variable so not easy to check</li>
<li>No methods let us interrogate the value
<ul>
<li>Not easy to test!</li>
<li>When things are hard to test, its generally a sign that they are not implemented in a very robust way</li>
<li>Right now version checking is a manual warning, but in future updates, we might seek to change this API to a more testable interface</li>
</ul></li>
</ul></li>
<li><p>Next we want to test the <code>__str__</code> method</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_str(<span class="va">self</span>):</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>      expected_str <span class="op">=</span> <span class="st">"""Stock Reference: Test</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="st">Price: 10</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="st">Stock level: 0</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="st">Tags: test:tag"""</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(<span class="bu">str</span>(item), expected_str)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>We rely on the fact that <code>__init__</code> has been tested</li>
<li>Then explicitly write out what the filled in string template should look like</li>
<li>Finally call <code>assertEqual</code> on the <code>str(item)</code> call, and then <code>expected_str</code></li>
</ul></li>
<li><p>Now lets test the <code>add_stock</code> method</p></li>
<li><p>There are three cases to consider here</p>
<ol type="1">
<li>The normal case - stock is added as expected</li>
<li>Trying to add more than the maximum - an exception is raised</li>
<li>Trying to add negative stock - an exception is raised</li>
</ol></li>
<li><p>Let’s implement these as three distinct tests</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_add_stock(<span class="va">self</span>):</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>      item.add_stock(<span class="dv">10</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">10</span>)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_add_stock_greater_than_maximum_raises_exception(<span class="va">self</span>):</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>          item.add_stock(StockItem.StockItem.max_stock_add <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_add_negative_stock_raises_exception(<span class="va">self</span>):</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>          item.add_stock(<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Each test checks one case</li>
<li>Makes each test small and easy to understand</li>
<li>Let’s us write long, descriptive names for all of them</li>
</ul></li>
<li><p>Now lastly, we have to implement the corresponding checks for <code>sell_stock</code></p>
<ol type="1">
<li>Selling stock <span class="math inline">\(&lt;\)</span> current stock level and <span class="math inline">\(&gt; 0\)</span> - stock is reduced as expected</li>
<li>Selling <span class="math inline">\(0\)</span> stock - an exception is raised</li>
<li>Selling negative stock - an exception is raised</li>
<li>Selling stock <span class="math inline">\(&gt;\)</span> current stock level - an exception is raised</li>
</ol></li>
<li><p>Again we’ll implement these as independent tests</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_sell_stock(<span class="va">self</span>):</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>      item.add_stock(<span class="dv">10</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>      item.sell_stock(<span class="dv">2</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(item.stock_level, <span class="dv">8</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_sell_zero_stock_raises_exception(<span class="va">self</span>):</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>      item.add_stock(<span class="dv">10</span>)</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>          item.sell_stock(<span class="dv">0</span>)</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_sell_negative_stock_raises_exception(<span class="va">self</span>):</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>      item.add_stock(<span class="dv">10</span>)</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>          item.sell_stock(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_sell_stock_greater_than_stock_level_raises_exception(<span class="va">self</span>):</span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>      item <span class="op">=</span> StockItem.StockItem(stock_ref<span class="op">=</span><span class="st">"Test"</span>, price<span class="op">=</span><span class="dv">10</span>, tags<span class="op">=</span><span class="st">"test:tag"</span>)</span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">Exception</span>):</span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a>          item.sell_stock(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>These all follow a similar structure to those for <code>add_stock</code></li>
<li>For <code>test_sell_zero_stock_raises_exception</code> and <code>test_sell_negative_stock_raises_exception</code> we use <code>add_stock</code>
<ul>
<li><code>add_stock</code> is tested, so we know it won’t break these tests</li>
<li>Let’s us be sure that these tests fail because the specific scenario is violated and not because of a different overlapping fail case (e.g.&nbsp;selling more stock than we have)</li>
</ul></li>
</ul></li>
<li><p>We can then run these tests,</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>unittest.main(verbosity<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="db237522" class="cell" data-execution_count="58">
<div class="cell-output cell-output-stderr">
<pre><code>test_add_negative_stock_raises_exception (__main__.TestStockItem.test_add_negative_stock_raises_exception) ... ok
test_add_stock (__main__.TestStockItem.test_add_stock) ... ok
test_add_stock_greater_than_maximum_raises_exception (__main__.TestStockItem.test_add_stock_greater_than_maximum_raises_exception) ... ok
test_init (__main__.TestStockItem.test_init) ... ok
test_sell_negative_stock_raises_exception (__main__.TestStockItem.test_sell_negative_stock_raises_exception) ... ok
test_sell_stock (__main__.TestStockItem.test_sell_stock) ... ok
test_sell_stock_greater_than_stock_level_raises_exception (__main__.TestStockItem.test_sell_stock_greater_than_stock_level_raises_exception) ... ok
test_sell_zero_stock_raises_exception (__main__.TestStockItem.test_sell_zero_stock_raises_exception) ... ok
test_str (__main__.TestStockItem.test_str) ... ok

----------------------------------------------------------------------
Ran 9 tests in 0.007s

OK</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc89bbf0&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-refactoring-ride-selector-to-support-testing" class="level4">
<h4 class="anchored" data-anchor-id="exercise-refactoring-ride-selector-to-support-testing">Exercise: Refactoring Ride Selector to Support Testing</h4>
<p><em>In Chapter 5 we designed the <a href="../../01_ProgrammingFundamentals/05_MakingDecisions/Chapter_05.html#use-decisions-to-make-an-application">Ride Selector Program</a>. When designing the UI, we considered how we would implement testing. Update the program to use</em> <code>unittest</code><em>. You may need to refactor the code to introduce testability</em></p>
<p>The most recent version of Ride Selector is given as an exercise in <a href="../../01_ProgrammingFundamentals/07_UsingFunctions/Chapter_07.html#make-something-happen-add-btcinput-to-your-existing-programs">Chapter 7</a> so we’ll use that version as our starting point.</p>
<p>As noted, the program as written is not amenable to testing. Everything is one big nested loop and the outputs printed directly to the terminal. We first need to refactor this program into one suitable for testing.</p>
<p>Let’s first start by defining a lightweight <code>Ride</code> class. Looking at our code we can see a ride has a name, and then optionally a maximum or minimum age. There is also a global minimum and maximum age limit.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Ride:</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">    A class representing a theme park amuse ride rider limitations</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">    name : str</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">        name of the ride</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">    min_age : int</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co">        minimum age in years to ride</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co">    max_age : int</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co">        maximum age in years to ride, must be greater than or equal to `min_age`</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Class Attributes</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------------</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ride_min_age : int</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co">        minimum `min_age` for any ride</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co">    ride_max_age : int</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co">        maximum `max_age` for any ride</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>    ride_min_age <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>    ride_max_age <span class="op">=</span> <span class="dv">95</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_valid_age_limit(age):</span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a><span class="co">        Check a proposed ride age limit is valid</span></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a><span class="co">        age : int</span></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="co">            proposed age limit in years</span></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a><span class="co">            `True` if `age` is an allowed age limit, else `False`</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a><span class="co">        See Also</span></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="co">        --------</span></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a><span class="co">        Ride.ride_min_age : minimum valid age limit for a ride</span></span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Ride.ride_max_age : maximum valid age limit for a ride</span></span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Ride.ride_min_age <span class="op">&lt;=</span> age <span class="op">&lt;=</span> Ride.ride_max_age</span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, min_age, max_age):</span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a><span class="co">        Creates a new `Ride` instance</span></span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a><span class="co">        name : str</span></span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a><span class="co">            name of the ride</span></span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a><span class="co">        min_age : int</span></span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a><span class="co">            minimum age (inclusive) to ride in years</span></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a><span class="co">        max_age : int</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a><span class="co">            maximum age to ride (inclusive) to ride in years.</span></span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a><span class="co">            `max_age` must be `&gt;= min_age`</span></span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb128-66"><a href="#cb128-66" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb128-67"><a href="#cb128-67" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb128-68"><a href="#cb128-68" aria-hidden="true" tabindex="-1"></a><span class="co">            Raised if `max_age` is `&lt; min_age`</span></span>
<span id="cb128-69"><a href="#cb128-69" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb128-70"><a href="#cb128-70" aria-hidden="true" tabindex="-1"></a><span class="co">            Raised if `min_age` or `max_age` is not a valid age limit</span></span>
<span id="cb128-71"><a href="#cb128-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-72"><a href="#cb128-72" aria-hidden="true" tabindex="-1"></a><span class="co">        See Also</span></span>
<span id="cb128-73"><a href="#cb128-73" aria-hidden="true" tabindex="-1"></a><span class="co">        --------</span></span>
<span id="cb128-74"><a href="#cb128-74" aria-hidden="true" tabindex="-1"></a><span class="co">        Ride.is_valid_age_limit : Checks that ages are valid</span></span>
<span id="cb128-75"><a href="#cb128-75" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb128-76"><a href="#cb128-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> Ride.is_valid_age_limit(min_age):</span>
<span id="cb128-77"><a href="#cb128-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb128-78"><a href="#cb128-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">"</span><span class="sc">{0}</span><span class="st"> is not a valid age for the minimum age limit"</span>.<span class="bu">format</span>(min_age)</span>
<span id="cb128-79"><a href="#cb128-79" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb128-80"><a href="#cb128-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> Ride.is_valid_age_limit(max_age):</span>
<span id="cb128-81"><a href="#cb128-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb128-82"><a href="#cb128-82" aria-hidden="true" tabindex="-1"></a>                <span class="st">"</span><span class="sc">{0}</span><span class="st"> is not a valid age for the maximum age limit"</span>.<span class="bu">format</span>(max_age)</span>
<span id="cb128-83"><a href="#cb128-83" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb128-84"><a href="#cb128-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_age <span class="op">&lt;</span> min_age:</span>
<span id="cb128-85"><a href="#cb128-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb128-86"><a href="#cb128-86" aria-hidden="true" tabindex="-1"></a>                <span class="st">"maximum age (</span><span class="sc">{0}</span><span class="st">) must be greater than or equal to minimum age (</span><span class="sc">{1}</span><span class="st">)"</span>.<span class="bu">format</span>(</span>
<span id="cb128-87"><a href="#cb128-87" aria-hidden="true" tabindex="-1"></a>                    max_age, min_age</span>
<span id="cb128-88"><a href="#cb128-88" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb128-89"><a href="#cb128-89" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb128-90"><a href="#cb128-90" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb128-91"><a href="#cb128-91" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.min_age <span class="op">=</span> min_age</span>
<span id="cb128-92"><a href="#cb128-92" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_age <span class="op">=</span> max_age</span>
<span id="cb128-93"><a href="#cb128-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-94"><a href="#cb128-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb128-95"><a href="#cb128-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.name)</span>
<span id="cb128-96"><a href="#cb128-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-97"><a href="#cb128-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> in_age_limit(<span class="va">self</span>, age):</span>
<span id="cb128-98"><a href="#cb128-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb128-99"><a href="#cb128-99" aria-hidden="true" tabindex="-1"></a><span class="co">        Validate that an age is within the limits of the ride</span></span>
<span id="cb128-100"><a href="#cb128-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-101"><a href="#cb128-101" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb128-102"><a href="#cb128-102" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb128-103"><a href="#cb128-103" aria-hidden="true" tabindex="-1"></a><span class="co">        age : int</span></span>
<span id="cb128-104"><a href="#cb128-104" aria-hidden="true" tabindex="-1"></a><span class="co">            age in years to validate is within the age limit</span></span>
<span id="cb128-105"><a href="#cb128-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-106"><a href="#cb128-106" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb128-107"><a href="#cb128-107" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb128-108"><a href="#cb128-108" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb128-109"><a href="#cb128-109" aria-hidden="true" tabindex="-1"></a><span class="co">            `True` if the age is within the ride limits, else `False`</span></span>
<span id="cb128-110"><a href="#cb128-110" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb128-111"><a href="#cb128-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.min_age <span class="op">&lt;=</span> age <span class="op">&lt;=</span> <span class="va">self</span>.max_age</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>The resulting class is lightweight</p></li>
<li><p>We define class variables <code>ride_min_age</code> and <code>ride_max_age</code> for the global minimum and maximum ages</p></li>
<li><p>We provide a function, <code>is_age_valid_age_limit</code> as a static method that checks a provided age is within these limits</p>
<ul>
<li><code>Ride</code> uses this internally to validate the <code>min_age</code> and <code>max_age</code> passed in <code>__init__</code></li>
<li>Can also be used externally to check if an age is allowed on any ride</li>
</ul></li>
<li><p>Defining our tests for <code>is_age_valid_age_limit</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> TestRide(unittest.TestCase):</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co">  Test class implementing unit tests for the `Ride` class</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test case for `is_valid_age_limit`</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_is_valid_age_accepts_normal_age(<span class="va">self</span>):</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertTrue(RideSelector.Ride.is_valid_age_limit(always_valid_middle_age))</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_is_valid_age_accepts_min_age(<span class="va">self</span>):</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertTrue(</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>              RideSelector.Ride.is_valid_age_limit(RideSelector.Ride.ride_min_age)</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_is_valid_age_accepts_max_age(<span class="va">self</span>):</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertTrue(</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>              RideSelector.Ride.is_valid_age_limit(RideSelector.Ride.ride_max_age)</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_is_valid_age_rejects_less_than_min_age(<span class="va">self</span>):</span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertFalse(</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>              RideSelector.Ride.is_valid_age_limit(RideSelector.Ride.ride_min_age <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_is_valid_age_rejects_greater_than_max_age(<span class="va">self</span>):</span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertFalse(</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>              RideSelector.Ride.is_valid_age_limit(RideSelector.Ride.ride_max_age <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>          )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>We can see there a range of test cases</p>
<ol type="1">
<li>Test a standard value within the range is accepted</li>
<li>Test the boundary values (<code>ride_min_age</code> and <code>ride_max_age</code>) are accepted</li>
<li>Test values outside the boundaries are rejected</li>
</ol></li>
</ul></li>
<li><p>Next we can define our <code>__init__</code> and <code>__str__</code> methods</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, min_age, max_age):</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">        Creates a new `Ride` instance</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co">        name : str</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="co">            name of the ride</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="co">        min_age : int</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="co">            minimum age (inclusive) to ride in years</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="co">        max_age : int</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="co">            maximum age to ride (inclusive) to ride in years.</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="co">            `max_age` must be `&gt;= min_age`</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="co">        ------</span></span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="co">            Raised if `max_age` is `&lt; min_age`</span></span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError</span></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a><span class="co">            Raised if `min_age` or `max_age` is not a valid age limit</span></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="co">        See Also</span></span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a><span class="co">        --------</span></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Ride.is_valid_age_limit : Checks that ages are valid</span></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> Ride.is_valid_age_limit(min_age):</span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"</span><span class="sc">{0}</span><span class="st"> is not a valid age for the minimum age limit"</span>.<span class="bu">format</span>(min_age)</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> Ride.is_valid_age_limit(max_age):</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb130-32"><a href="#cb130-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"</span><span class="sc">{0}</span><span class="st"> is not a valid age for the maximum age limit"</span>.<span class="bu">format</span>(max_age)</span>
<span id="cb130-33"><a href="#cb130-33" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb130-34"><a href="#cb130-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_age <span class="op">&lt;</span> min_age:</span>
<span id="cb130-35"><a href="#cb130-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb130-36"><a href="#cb130-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">"maximum age (</span><span class="sc">{0}</span><span class="st">) must be greater than or equal to minimum age (</span><span class="sc">{1}</span><span class="st">)"</span>.<span class="bu">format</span>(</span>
<span id="cb130-37"><a href="#cb130-37" aria-hidden="true" tabindex="-1"></a>                    max_age, min_age</span>
<span id="cb130-38"><a href="#cb130-38" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb130-39"><a href="#cb130-39" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb130-40"><a href="#cb130-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb130-41"><a href="#cb130-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.min_age <span class="op">=</span> min_age</span>
<span id="cb130-42"><a href="#cb130-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_age <span class="op">=</span> max_age</span>
<span id="cb130-43"><a href="#cb130-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-44"><a href="#cb130-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb130-45"><a href="#cb130-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.name)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>The <code>__init__</code> checks that the passed <code>min_range</code> and <code>max_range</code> are valid</p>
<ul>
<li>Then checks that <code>min_range</code> and <code>max_range</code> follow the correct ordering</li>
</ul></li>
<li><p>Once the input is validated just sets the appropriate data values</p>
<ul>
<li>We’re leaving them public for the simplicity of demonstration</li>
</ul></li>
<li><p>Our <code>__str__</code> method is defined to simply return <code>self.name</code> as a string</p></li>
<li><p>We have a few tests here</p>
<ol type="1">
<li>Test that we can construct an object normally and have the values set</li>
<li>Test that an invalid <code>min_age</code> is rejected</li>
<li>Test that an invalid <code>max_age</code> is rejected</li>
<li>Test that <code>min_age</code> may not be greater than <code>max_age</code></li>
<li>Check that the appropriate string is returned</li>
</ol></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test cases for init</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_init_sets_attributes_correctly(<span class="va">self</span>):</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>        ride <span class="op">=</span> RideSelector.Ride(</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Test"</span>, min_age<span class="op">=</span>always_valid_middle_age, max_age<span class="op">=</span>always_valid_middle_age</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(ride.name, <span class="st">"Test"</span>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(ride.min_age, always_valid_middle_age)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(ride.max_age, always_valid_middle_age)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_init_raises_valueerror_on_invalid_min_age(<span class="va">self</span>):</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">ValueError</span>):</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>            ride <span class="op">=</span> RideSelector.Ride(  <span class="co"># noqa: F841</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Test"</span>,</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>                min_age<span class="op">=</span>RideSelector.Ride.ride_min_age <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>                max_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_init_raises_valueerror_on_invalid_max_age(<span class="va">self</span>):</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">ValueError</span>):</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>            ride <span class="op">=</span> RideSelector.Ride(  <span class="co"># noqa: F841</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Test"</span>,</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>                min_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>                max_age<span class="op">=</span>RideSelector.Ride.ride_max_age <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_init_raises_value_error_if_max_age_less_than_min_age(<span class="va">self</span>):</span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">ValueError</span>):</span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>            ride <span class="op">=</span> RideSelector.Ride(  <span class="co"># noqa: F841</span></span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Test"</span>,</span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>                min_age<span class="op">=</span>RideSelector.Ride.ride_max_age <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a>                max_age<span class="op">=</span>RideSelector.Ride.ride_min_age <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_str_returns_ride_name(<span class="va">self</span>):</span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>        ride <span class="op">=</span> RideSelector.Ride(</span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Test"</span>,</span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a>            min_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb131-39"><a href="#cb131-39" aria-hidden="true" tabindex="-1"></a>            max_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb131-40"><a href="#cb131-40" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb131-41"><a href="#cb131-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(<span class="bu">str</span>(ride), <span class="st">"Test"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>The last method on <code>Ride</code> is one that now checks if a given age is accepted by the specific <code>Ride</code> instance</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> in_age_limit(<span class="va">self</span>, age):</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">        Validate that an age is within the limits of the ride</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co">        age : int</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co">            age in years to validate is within the age limit</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">            `True` if the age is within the ride limits, else `False`</span></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.min_age <span class="op">&lt;=</span> age <span class="op">&lt;=</span> <span class="va">self</span>.max_age</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>We pretty much want to test the same cases as for <code>is_valid_age_limit</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_in_age_limit_accepts_valid_age(<span class="va">self</span>):</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> RideSelector.Ride(</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Test"</span>,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>          min_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>          max_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertTrue(ride.in_age_limit(always_valid_middle_age))</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_in_age_limit_rejects_too_small_age(<span class="va">self</span>):</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> RideSelector.Ride(</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Test"</span>,</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>          min_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>          max_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertFalse(ride.in_age_limit(ride.min_age <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_in_age_limit_rejects_too_large_age(<span class="va">self</span>):</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> RideSelector.Ride(</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Test"</span>,</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>          min_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>          max_age<span class="op">=</span>always_valid_middle_age,</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertFalse(ride.in_age_limit(ride.max_age <span class="op">+</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Next we construct our <code>RideSelector</code> class</p>
<ul>
<li>For simplicity this implementation mixes some of the container management aspects with the UI presentation aspects</li>
<li>Since some of the functionality requires user input or provides output to the user, we can’t test absolutely everything</li>
<li>Goal is to factor out the individual steps into functions that accept arguments and return values</li>
<li>These can then be tested against</li>
</ul></li>
<li><p><code>RideSelector</code> starts with a basic <code>__init__</code> method that populates it with a preset lookup table of rides</p></li>
<li><p>The <code>__str__</code> method converts the tuple of rides into an indexed list as a string</p></li>
<li><p>We’ll ignore testing the <code>__init__</code> method for now</p>
<ul>
<li>Since it’s not interesting</li>
</ul></li>
<li><p><code>__str__</code> uses a quite complicated <code>lambda</code> though to perform it’s magic</p>
<ul>
<li>The idea is to map the tuple elements to their enumerated pair
<ul>
<li>i.e.&nbsp;a tuple containing the index and the value</li>
</ul></li>
<li>We then write use a lambda that maps the enumerated pair to the form <code>x. value</code> where <code>x</code> is the <span class="math inline">\(index + 1\)</span> (since we want to convert from <span class="math inline">\(0\)</span>-indexed to <span class="math inline">\(1\)</span>-indexed) and <code>value</code> is the actual value</li>
<li>We then use <code>map</code> to apply the lambda to all elements of the <code>enumerate</code> object</li>
<li>Lastly convert into our string using <code>"\n".join</code></li>
<li>This is quite a complicated set of steps and so should be tested</li>
</ul></li>
<li><p>We’ll define a new test class for the <code>RideSelector</code> tests</p>
<ul>
<li>This is to make them distinct</li>
<li>In a bigger program we would probably separate out each components tests into their own test file</li>
<li>Our <code>__str__</code> test will take define an expected string and compare this to the result of calling the <code>__str__</code> method</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> TestRideSelector(unittest.TestCase):</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="co">  Test cases for the `RideSelector` class</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test str method</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> test_str_creates_enumerated_table(<span class="va">self</span>):</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>          ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>          expected_str <span class="op">=</span> <span class="st">"""1. Scenic River Cruise</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="st">  2. Carnival Carousel</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="st">  3. Jungle Adventure Water Splash</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="st">  4. Downhill Mountain Run</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="st">  5. The Regurgitator"""</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>          <span class="va">self</span>.assertEqual(<span class="bu">str</span>(ride_selector), expected_str)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Next we define a <code>get_ride</code> method that converts a user selection of a ride into the corresponding ride object</p></li>
<li><p>This has a simple implementation</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> get_ride(<span class="va">self</span>, index):</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">"""</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">      Get's the ride associated with a given index</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">      Parameters</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">      ----------</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">      index : int</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">          integer greater than zero corresponding a ride index</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">      Returns</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">      -------</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="co">      Ride</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co">          the ride stored by the given index</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co">      Raises</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co">      ------</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="co">      ValueError</span></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a><span class="co">          Raised if `index &lt;= 0`</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co">      IndexError</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a><span class="co">          Raised if the no ride exists for the given index</span></span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a><span class="co">      """</span></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> index <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>          <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"index must be a positive integer"</span>)</span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">self</span>._rides[index <span class="op">-</span> <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>There are clear cases to test here</p>
<ol type="1">
<li>That a valid index returns the correct <code>Ride</code> instance</li>
<li>That a non-positive index returns a <code>ValueError</code></li>
<li>That an invalid index returns an <code>IndexError</code></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test get_ride method</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_get_ride_returns_expected_ride(<span class="va">self</span>):</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">1</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(<span class="bu">str</span>(ride), <span class="st">"Scenic River Cruise"</span>)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_get_ride_raises_valueerror_on_zero_index(<span class="va">self</span>):</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">ValueError</span>):</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>          ride_selector.get_ride(<span class="dv">0</span>)</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_get_ride_raises_valueerror_on_invalid_index(<span class="va">self</span>):</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">with</span> <span class="va">self</span>.assertRaises(<span class="pp">IndexError</span>):</span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>          ride_selector.get_ride(<span class="dv">99</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Our last testable component in then, <code>check_age_against_ride</code></p>
<ul>
<li>This takes in an age and a ride</li>
<li>Checks in a person of that age can ride the ride</li>
<li>This has two stages
<ol type="1">
<li>First validate that person can ride <em>any</em> ride
<ul>
<li>Using <code>Ride.is_valid_age_limit</code></li>
</ul></li>
<li>Validate that person can ride the specific ride they selected
<ul>
<li>Using that ride’s <code>in_age_limit</code> method</li>
</ul></li>
</ol></li>
<li>Returns a string to display to the caller the outcome</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> check_age_against_ride(<span class="va">self</span>, ride, age):</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">"""</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co">      Provides a string describing in a rider of `age` years can ride the Ride `ride`</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co">      Parameters</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">      ----------</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co">      ride : Ride</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co">          ride to check the age against</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co">      age : int</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co">          age of the prospective rider in years</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co">      Returns</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co">      -------</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="co">      str</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="co">          string describing if a rider of `age` years can ride `ride`</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="co">      """</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> age <span class="op">&lt;</span> Ride.ride_min_age:</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">"You are too young to go on any rides"</span></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> age <span class="op">&gt;</span> Ride.ride_max_age:</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">"You are too old to go on any rides"</span></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> age <span class="op">&lt;</span> ride.min_age:</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">"Sorry, you are too young"</span></span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> age <span class="op">&gt;</span> ride.max_age:</span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">"Sorry, you are too old"</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">"You can go on the ride"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>We want to test these strings are returned correctly</p></li>
<li><p>There are a few cases</p>
<ol type="1">
<li>Too young to go on any ride</li>
<li>Too young to go on this specific ride</li>
<li>Too old to go on any ride</li>
<li>Too old to go on this specific ride</li>
<li>Able to go on the ride</li>
</ol></li>
<li><p>Luckily since string literals are returned, we can check this easily</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>      <span class="co"># test check age against ride</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_too_young_for_any_ride(<span class="va">self</span>):</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">1</span>)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"You are too young to go on any rides"</span>,</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>          ride_selector.check_age_against_ride(</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>              ride, RideSelector.Ride.ride_min_age <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_too_old_for_any_ride(<span class="va">self</span>):</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">1</span>)</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">"You are too old to go on any rides"</span>,</span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>          ride_selector.check_age_against_ride(</span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>              ride, RideSelector.Ride.ride_max_age <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_too_young_for_specific_ride(<span class="va">self</span>):</span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">5</span>)</span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(</span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Sorry, you are too young"</span>,</span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a>          ride_selector.check_age_against_ride(ride, ride.min_age <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb138-30"><a href="#cb138-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-31"><a href="#cb138-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_too_old_for_specific_ride(<span class="va">self</span>):</span>
<span id="cb138-32"><a href="#cb138-32" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb138-33"><a href="#cb138-33" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">5</span>)</span>
<span id="cb138-34"><a href="#cb138-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(</span>
<span id="cb138-35"><a href="#cb138-35" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Sorry, you are too old"</span>,</span>
<span id="cb138-36"><a href="#cb138-36" aria-hidden="true" tabindex="-1"></a>          ride_selector.check_age_against_ride(ride, ride.max_age <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb138-37"><a href="#cb138-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb138-38"><a href="#cb138-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-39"><a href="#cb138-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> test_valid_age_is_accepted(<span class="va">self</span>):</span>
<span id="cb138-40"><a href="#cb138-40" aria-hidden="true" tabindex="-1"></a>      ride_selector <span class="op">=</span> RideSelector.RideSelector()</span>
<span id="cb138-41"><a href="#cb138-41" aria-hidden="true" tabindex="-1"></a>      ride <span class="op">=</span> ride_selector.get_ride(<span class="dv">5</span>)</span>
<span id="cb138-42"><a href="#cb138-42" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.assertEqual(</span>
<span id="cb138-43"><a href="#cb138-43" aria-hidden="true" tabindex="-1"></a>          <span class="st">"You can go on the ride"</span>,</span>
<span id="cb138-44"><a href="#cb138-44" aria-hidden="true" tabindex="-1"></a>          ride_selector.check_age_against_ride(ride, ride.min_age),</span>
<span id="cb138-45"><a href="#cb138-45" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>The last step is to the then run the tests</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>unitttest.main()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="baa1fcf4" class="cell" data-execution_count="59">
<div class="cell-output cell-output-stderr">
<pre><code>...............................
----------------------------------------------------------------------
Ran 31 tests in 0.021s

OK</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>&lt;unittest.main.TestProgram at 0x7f2efc253980&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Be careful with how you design your tests</strong></p>
<p>Tests are designed generally to test expected behaviours. This is why test-driven development typically expects you to write the test before the implementation. The idea being that by first defining the behaviour you want rather than testing a specific implementation you avoid coupling your test directly to your implementation.</p>
<p>This can be hard to avoid to some degree when dealing with unit tests because by their nature they test a specific unit. However, let’s look at our tests and some of the design choices. One of the main things I have done for some of the tests is to parameterise the values being tested, rather than hard-coding values. There is a trade-off here. The tests are a bit more opaque but are in theory flexible to changes. For example I have used the <code>Ride.ride_min_age</code> and <code>Ride.ride_max_age</code> points are:</p>
<ol type="1">
<li>By using the values, we make the tests test the behaviour rather than the specific chosen values</li>
<li>We couple the test to the implementation providing those class attributes</li>
<li>If we change those values we <em>might</em> actually want the tests to fail, so that we can then manually ensure that the change is correct
<ul>
<li>Then update the test</li>
<li>However, this has the problem, that our test is then being dictated by the implementation</li>
<li>If we revert a change we would have to again rework the tests</li>
</ul></li>
</ol>
<p>The notion of using parameters versus specific-values is a choice in testing, the above is just an example of how to think about how to test. The other consideration is if the testing framework fits with the design of your program. In rewiring the ride selector program we’ve arguably made it more complex and harder to reason about by trying to fit it into the individual component model that <code>unittest</code> expects. For Ride Selector which provides a fairly simple user interface where we mostly care about the user receiving the correct response a better testing implementation might actually be to test the program <em>externally</em>. By this we mean, we generate a test set of inputs, feed them into the program and record the outputs. We then compare these outputs to the expected outputs.</p>
<p>Doing the testing this way has some tradeoffs. By testing the system as a whole it’s harder to identify where the sources of failures arise. However, the overall program doesn’t need to be refactored into a more complicated form just to facilitate the tests</p>
</div>
</div>
</section>
</section>
<section id="view-program-documentation" class="level3">
<h3 class="anchored" data-anchor-id="view-program-documentation">View Program Documentation</h3>
<ul>
<li>We saw that you could add docstrings to functions to describe their behaviour</li>
<li>Implicitly in the examples you’ve also seen these added to classes</li>
<li>Modules can also have docstrings too!
<ul>
<li>The only rule across all three is that the docstring is the first statement after the start
<ul>
<li>i.e.&nbsp;for a function, after the function definition</li>
<li>for a class, after the class definition</li>
<li>for a module, the first statement in the file</li>
</ul></li>
</ul></li>
</ul>
<section id="make-something-happen-explore-pydoc" class="level4">
<h4 class="anchored" data-anchor-id="make-something-happen-explore-pydoc">Make Something Happen: Explore <code>pydoc</code></h4>
<p><code>Pydoc</code> <em>is a program written in python that can be run from the command line. Work through the following steps to see how it works</em></p>
<ol type="1">
<li><p><em>Navigate to the folder <a href="./Examples/10_FashionShopWithDocumentation/">10_FashionShopWithDocumentation</a></em></p></li>
<li><p><em>Open a terminal in this folder (or navigate to this folder in the terminal)</em></p></li>
<li><p><em>Run the</em> <code>pydoc</code> <em>module, by executing the following command,</em></p>
<pre class="shell"><code> python -m pydoc</code></pre>
<ul>
<li><p>The <code>-m</code> following the call to python means “execute the following module”</p></li>
<li><p>Running on <code>pydoc</code> with no additional arguments we can see it provides documentation about <code>pydoc</code> itself</p>
<div id="a5d97d31" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> python <span class="op">-</span>m pydoc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>pydoc - the Python documentation tool

pydoc &lt;name&gt; ...
    Show text documentation on something.  &lt;name&gt; may be the name of a
    Python keyword, topic, function, module, or package, or a dotted
    reference to a class or function within a module or module in a
    package.  If &lt;name&gt; contains a '/', it is used as the path to a
    Python source file to document. If name is 'keywords', 'topics',
    or 'modules', a listing of these things is displayed.

pydoc -k &lt;keyword&gt;
    Search for a keyword in the synopsis lines of all available modules.

pydoc -n &lt;hostname&gt;
    Start an HTTP server with the given hostname (default: localhost).

pydoc -p &lt;port&gt;
    Start an HTTP server on the given port on the local machine.  Port
    number 0 can be used to get an arbitrary unused port.

pydoc -b
    Start an HTTP server on an arbitrary unused port and open a web browser
    to interactively browse documentation.  This option can be used in
    combination with -n and/or -p.

pydoc -w &lt;name&gt; ...
    Write out the HTML documentation for a module to a file in the current
    directory.  If &lt;name&gt; contains a '/', it is treated as a filename; if
    it names a directory, documentation is written for all the contents.
</code></pre>
</div>
</div></li>
<li><p>We can see from the output that <code>pydoc</code> is a documentation tool</p></li>
<li><p>There a number of different arguments we can supply that modify how it runs</p></li>
</ul></li>
<li><p><em>For now we want to start a webpage to read our documentation. Reading the documentation we can see this can be done using the</em> <code>-b</code> <em>flag. Enter the following</em></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a> python <span class="op">-</span>m pydoc <span class="op">-</span>b</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p><code>pydoc</code> will then start a website that can be used to view the documentation</p></li>
<li><p>The result should look something like the screenshot below</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Examples/10_FashionShopWithDocumentation/pydoc_screenshot.png" class="img-fluid figure-img"></p>
<figcaption>Generated Pydoc Website</figcaption>
</figure>
</div></li>
<li><p>We can see the site contains links to python’s built-in modules</p></li>
<li><p>But there is also a section for our own documented modules,</p>
<ul>
<li>I’ve included the generated html so you can interact with them directly
<ol type="1">
<li><a href="./Examples/10_FashionShopWithDocumentation/Docs/Data.html">Data</a></li>
<li><a href="./Examples/10_FashionShopWithDocumentation/Docs/FashionShopShellUI.html">FashionShopShellUI</a></li>
<li><a href="./Examples/10_FashionShopWithDocumentation/Docs/RunTests.html">RunTests</a></li>
</ol></li>
</ul></li>
<li><p>You can also use the built-in search bar</p></li>
<li><p>The docstrings are now displayed for the module, class and each method</p></li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Modules that run as programs can break pydoc</strong></p>
<p>Recall that when loaded a module will execute all of the statements that it includes. For <code>pydoc</code> to generate the docstrings and site material from a module it first has to load it. This means that it <em>will</em> lead to those statements being executed.</p>
<p>This means that if we had a module that represented an entry point to looping user input (such as <a href="./Examples/10_FashionShopWithDocumentation/FashionShopShellUI.py">FashionShopShellUI.py</a>) it would immediately start executing and freeze <code>pydoc</code>. This is a reminder to use name guards to control the context in which a module can be executed.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">__name__</span> <span class="op">=</span> <span class="st">"__main__"</span>:</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># do things that should only occur if the module is executed directly</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li>We’ve seen that testing can be automated and integrated into a program</li>
<li><code>unittest</code> is an in-built framework for performing unit testing
<ul>
<li>Unit tests are small tests that test a specific behaviour</li>
</ul></li>
<li>Documentation is an important part of software development
<ul>
<li>Documentation can be added as docstrings to functions, classes and modules</li>
<li>Documentation can automatically be rendered
<ul>
<li><code>pydoc</code> is an inbuilt python program for generating html sites of python documentation</li>
</ul></li>
</ul></li>
<li>Variables can refer to functions
<ul>
<li>Function references allow us to be flexible in implementing an interface</li>
</ul></li>
<li>Lambda expressions allow us to write small expressions that apply actions to data
<ul>
<li>Lambda’s can also be treated as data themselves</li>
</ul></li>
<li><code>yield</code> allows us to write functions that serve as iterators</li>
<li>We can create packages in python
<ul>
<li>Packages organise and group up modules</li>
</ul></li>
<li>Variables can refer to classes
<ul>
<li>Allows us to be flexible in implementation like with function references</li>
</ul></li>
</ul>
</section>
<section id="questions-and-answers" class="level2">
<h2 class="anchored" data-anchor-id="questions-and-answers">Questions and Answers</h2>
<ol type="1">
<li><p><em>Is everything in python an object?</em></p>
<ul>
<li>Yes</li>
<li>The advantage of python’s dynamic typing system is that everything is an object and can be treated as one</li>
<li>let’s us pass around a lot of different things to various parts of a system
<ul>
<li>Gives us lots of why to be flexible in implementation</li>
</ul></li>
<li>The downside is that since there is no strict type checking we can get into situations where invalid objects are being passed
<ul>
<li>e.g.&nbsp;we might try to call a method on an <code>int</code> that it doesn’t possess</li>
</ul></li>
</ul></li>
<li><p><em>Should I feel bad if I don’t understand things like lambda expressions and yield?</em></p>
<ul>
<li>No</li>
<li>These are advanced and complicated features</li>
<li>It’s also natural for a concept to require repeated exposure and multiple passes to sink in</li>
<li>With simple programs you generally will not have a natural use for these features
<ul>
<li>When you do have those use cases though, they are powerful</li>
</ul></li>
</ul></li>
<li><p><em>What happens when I move python packages from one computer to another?</em></p>
<ul>
<li>They should work out of the box as long as a user has the correct version of python installed</li>
<li>If you mess with the directory structure you may need to update the packages
<ul>
<li>(See the comments about importing in packages made earlier)</li>
</ul></li>
<li>A more permanent way is to <em>publish</em> a package, so that it can be installed (and preferably downloaded from the internet)</li>
</ul></li>
<li><p><em>When should I write my documentation and tests?</em></p>
<ul>
<li><p>As you go along</p></li>
<li><p>There is a natural back and forth between documentation, tests and implementation</p></li>
<li><p>For a typical example workflow we might have a part of project we’re working on</p>
<ol type="1">
<li>We start by documenting the design process</li>
<li>We right some simple tests that we should aim to fulfill</li>
<li>We then create an implementation</li>
<li>We document the implementation as we go (preferably in code)</li>
<li>We ensure the implementation passes the basic tests</li>
<li>We add further tests to capture any unexpected behaviour found while implementing</li>
</ol></li>
<li><p>Generally it is much easier to document a program as you write it and things are fresh than it is to go back and do it all</p></li>
<li><p>Same for tests</p>
<ul>
<li>Write small bits of code then test them</li>
<li>Easier and more likely to result in a working program than writing one large block and a bunch of tests</li>
<li>Pythons dynamic typing and runtime error handling makes it very painful to try and fix large broken programs</li>
</ul></li>
</ul></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>